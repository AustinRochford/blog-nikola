<meta name="title" content="A PyMC3 Analysis of Tyrannosaurid Growth Curves" />
<meta name="tags" content="Bayesian Statistics, PyMC3, Examples" />
<meta name="date" content="2021-05-17" />
<meta name="has_math" content="true" /><style>
.dataframe * {border-color: #c0c0c0 !important;}
.dataframe th{background: #eee;}
.dataframe td{
    background: #fff;
    text-align: right; 
    min-width:5em;
}

/* Format summary rows */
.dataframe-summary-row tr:last-child,
.dataframe-summary-col td:last-child{
background: #eee;
    font-weight: 500;
}
</style>
<p>In Chapter 7 of their excellent book <a href="https://bayessm.org/"><em>Bayesian Statistical Methods</em></a> (<em>BSM</em> from now on), Reich and Ghosh work an <a href="https://www4.stat.ncsu.edu/~bjreich/BSMdata/T_rex.html">example analysis</a> of the growth rates of <a href="https://en.wikipedia.org/wiki/Tyrannosauridae">Tyrannosaurids</a> in <code>R</code> using <a href="https://en.wikipedia.org/wiki/Just_another_Gibbs_sampler"><code>JAGS</code></a>. This dataset and analysis are quite fun, so this post shows how to execute (almost) the same analysis in Python using PyCM3.</p>
<center>
<img src="https://img1.wsimg.com/isteam/ip/63bbf664-7db2-4c45-85ac-173680b714eb/b6a4ffdf-0e5b-4680-a317-d03661e7fa56.jpg" width=500>
</center>
<h2 id="the-dataset">The Dataset</h2>
<figure>
<center>
<p><img src="https://austinrochford.com/resources/img/lego_trex.png" width=700 alt="Lego Tyrannosaurus Rex eating paleontologist minifigure"></p>
<caption>
In addition to statistics, I am a Lego nerd.
</caption>
</center>
</figure>
<p>To quote <em>BSM</em>,</p>
<blockquote>
<p>We analyze the data from 20 fossils to estimate the growth curves of four tyrannosaurid species: Albertosaurus, Daspletosaurus, Gorgosaurus and Tyrannosaurus. The data are taken from Table 1 of Erickson, GM et al (2004).</p>
</blockquote>
<p>First we make some standard Python imports and load the dataset from the author’s website.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="op">%</span>matplotlib inline</span></code></pre></div>
<div class="sourceCode" id="cb2"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> warnings <span class="im">import</span> filterwarnings</span></code></pre></div>
<div class="sourceCode" id="cb3"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> aesara <span class="im">import</span> shared, tensor <span class="im">as</span> at</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> arviz <span class="im">as</span> az</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> matplotlib <span class="im">import</span> MatplotlibDeprecationWarning, pyplot <span class="im">as</span> plt</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pymc3 <span class="im">as</span> pm</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span></code></pre></div>
<div class="sourceCode" id="cb4"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>filterwarnings(<span class="st">&#39;ignore&#39;</span>, category<span class="op">=</span><span class="pp">UserWarning</span>, module<span class="op">=</span><span class="st">&#39;aesara&#39;</span>)</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>filterwarnings(<span class="st">&#39;ignore&#39;</span>, category<span class="op">=</span><span class="pp">UserWarning</span>, module<span class="op">=</span><span class="st">&#39;arviz&#39;</span>)</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>filterwarnings(<span class="st">&#39;ignore&#39;</span>, category<span class="op">=</span>MatplotlibDeprecationWarning, module<span class="op">=</span><span class="st">&#39;pandas&#39;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb5"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>sns.<span class="bu">set</span>(color_codes<span class="op">=</span><span class="va">True</span>)</span></code></pre></div>
<div class="sourceCode" id="cb6"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="op">%%</span>bash</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>DATA_URI<span class="op">=</span>https:<span class="op">//</span>www4.stat.ncsu.edu<span class="op">/~</span>bjreich<span class="op">/</span>BSMdata<span class="op">/</span>Erickson.csv</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>DATA_DEST<span class="op">=/</span>tmp<span class="op">/</span>Erickson.csv</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> [[ <span class="op">!</span> <span class="op">-</span>e $DATA_DEST ]]<span class="op">;</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>then</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>    wget <span class="op">-</span>q <span class="op">-</span>O $DATA_DEST $DATA_URI</span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>fi</span></code></pre></div>
<div class="sourceCode" id="cb7"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> (pd.read_csv(<span class="st">&#39;/tmp/Erickson.csv&#39;</span>)</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>        .rename(columns<span class="op">=</span><span class="bu">str</span>.lower)</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>        .sort_values(<span class="st">&#39;age&#39;</span>)</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>        .reset_index(drop<span class="op">=</span><span class="va">True</span>))</span></code></pre></div>
<div class="sourceCode" id="cb8"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>df.head()</span></code></pre></div>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<center>
<table border="1" class="dataframe">
<thead>
<tr style="text-align: right;">
<th>
</th>
<th>
taxon
</th>
<th>
spec. #
</th>
<th>
age
</th>
<th>
mass
</th>
</tr>
</thead>
<tbody>
<tr>
<th>
0
</th>
<td>
Albertosaurus
</td>
<td>
RTMP 2002.45.46
</td>
<td>
2
</td>
<td>
50.3
</td>
</tr>
<tr>
<th>
1
</th>
<td>
Tyrannosaurus
</td>
<td>
LACM 28471
</td>
<td>
2
</td>
<td>
29.9
</td>
</tr>
<tr>
<th>
2
</th>
<td>
Gorgosaurus
</td>
<td>
FMNH PR2211
</td>
<td>
5
</td>
<td>
127.0
</td>
</tr>
<tr>
<th>
3
</th>
<td>
Gorgosaurus
</td>
<td>
RTMP 86.144.1
</td>
<td>
7
</td>
<td>
229.0
</td>
</tr>
<tr>
<th>
4
</th>
<td>
Daspletosaurus
</td>
<td>
RTMP 94.143.1
</td>
<td>
10
</td>
<td>
496.0
</td>
</tr>
</tbody>
</table>
</div>
</center>
<h3 id="exploratory-data-analysis">Exploratory data analysis</h3>
<p>First we summarize and plot the data.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>df.describe()</span></code></pre></div>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<center>
<table border="1" class="dataframe">
<thead>
<tr style="text-align: right;">
<th>
</th>
<th>
age
</th>
<th>
mass
</th>
</tr>
</thead>
<tbody>
<tr>
<th>
count
</th>
<td>
20.00000
</td>
<td>
20.000000
</td>
</tr>
<tr>
<th>
mean
</th>
<td>
15.10000
</td>
<td>
1568.760000
</td>
</tr>
<tr>
<th>
std
</th>
<td>
7.05542
</td>
<td>
1562.465702
</td>
</tr>
<tr>
<th>
min
</th>
<td>
2.00000
</td>
<td>
29.900000
</td>
</tr>
<tr>
<th>
25%
</th>
<td>
13.00000
</td>
<td>
579.250000
</td>
</tr>
<tr>
<th>
50%
</th>
<td>
15.50000
</td>
<td>
1123.500000
</td>
</tr>
<tr>
<th>
75%
</th>
<td>
18.75000
</td>
<td>
1795.000000
</td>
</tr>
<tr>
<th>
max
</th>
<td>
28.00000
</td>
<td>
5654.000000
</td>
</tr>
</tbody>
</table>
</div>
</center>
<p><br></p>
<div class="sourceCode" id="cb10"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>grid <span class="op">=</span> sns.catplot(x<span class="op">=</span><span class="st">&#39;age&#39;</span>, y<span class="op">=</span><span class="st">&#39;mass&#39;</span>, hue<span class="op">=</span><span class="st">&#39;taxon&#39;</span>, data<span class="op">=</span>df)</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>grid.ax.set_xlim(left<span class="op">=</span><span class="dv">1</span>)<span class="op">;</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>grid.ax.set_xscale(<span class="st">&#39;log&#39;</span>)<span class="op">;</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>grid.ax.set_ylim(bottom<span class="op">=</span><span class="dv">100</span>)<span class="op">;</span></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>grid.ax.set_yscale(<span class="st">&#39;log&#39;</span>)<span class="op">;</span></span></code></pre></div>
<center>
<img src="/resources/tyrannosaurid/Growth%20Curves%20REPARAM_14_0.png" title="fig:" alt="png" />
</center>
<p>Note the logarithmic scale on both of the axes here. A few points are immediately apparent.</p>
<ol type="1">
<li>There are only 20 samples, so the data is fairly small.</li>
<li>Mass varies fairly widely across taxa.</li>
<li>The relationship between age and mass appears linear on the log-log scale.</li>
<li>Variance appears to increase with age.</li>
</ol>
<h2 id="modeling">Modeling</h2>
<p>Given the third and fourth observations about the data,</p>
<blockquote>
<p>[w]e use multiplicative error rather than additive error because variation in the population likely increases with mass/age.</p>
</blockquote>
<p>Throughout this post <span class="math inline">\(Y_i\)</span> and <span class="math inline">\(X_i\)</span> will correspond to the mass and age of the <span class="math inline">\(i\)</span>-th sample respectively. Each of our four models will take the form</p>
<p><span class="math display">\[Y_i = f_{j(i)}(X_i) \cdot \varepsilon_{j(i)}.\]</span></p>
<p>Here <span class="math inline">\(\varepsilon_j\)</span> corresponds to the multiplicative error for the <span class="math inline">\(j\)</span>-th taxon and <span class="math inline">\(j(i)\)</span> is the taxon identifier of the <span class="math inline">\(i\)</span>-th sample.</p>
<p>We place a <a href="https://en.wikipedia.org/wiki/Log-normal_distribution">log-normal</a> prior on <span class="math inline">\(\varepsilon_j\)</span> so that $ (_j) = 1$ and <span class="math inline">\(\textrm{Var}\left(\log(\varepsilon_j)\right) = \sigma_j^2\)</span>. With the notation <span class="math inline">\(y_i = \log Y_i\)</span> and <span class="math inline">\(x_i = \log X_i\)</span>, standard <a href="https://en.wikipedia.org/wiki/Log-normal_distribution#Generation_and_parameters">distributional math</a> shows that</p>
<p><span class="math display">\[y_i \sim N\left(\log\left(f_{j(i)}(X_{j(i)})\right) - \frac{\sigma_{j(i)}^2}{2}, \sigma_{j(i)}^2\right).\]</span></p>
<p>Each of the four models we consider arises from a choice of the form of <span class="math inline">\(f_j(X)\)</span> (along with a prior for any of its unknown parameters) and a prior on <span class="math inline">\(\sigma_j\)</span>.</p>
<h3 id="unpooled-log-linear-model">Unpooled log-linear model</h3>
<p>Given the third observation above, we begin with a log-linear model for the relationship between age and mass. If</p>
<p><span class="math display">\[f_j(X) = A_j \cdot X^{b_j}\]</span></p>
<p>then</p>
<p><span class="math display">\[\log\left(f_j(X)\right) = a_j + b_j \log X,\]</span></p>
<p>where <span class="math inline">\(a_j = \log A_j\)</span>.</p>
<p>We define <code>log_age</code> and <code>log_mass</code> which correspond to <span class="math inline">\(x_i\)</span> and <span class="math inline">\(y_i\)</span> respectively.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>log_age <span class="op">=</span> np.log(df[<span class="st">&#39;age&#39;</span>].values)</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>log_mass <span class="op">=</span> np.log(df[<span class="st">&#39;mass&#39;</span>].values)</span></code></pre></div>
<p>We turn the taxon names into numeric identifiers and set up <code>shared</code> containers for <code>log_age</code> and <code>taxon_id</code>. These <code>shared</code> containers are <a href="https://github.com/pymc-devs/aesara"><code>aesara</code></a>’s way to facilitate <a href="https://en.wikipedia.org/wiki/Posterior_predictive_distribution">posterior predictive</a> sampling. <code>aesara</code> is the PyMC team’s fork of <a href="https://github.com/Theano/Theano"><code>theano</code></a>. Since active development on <code>theano</code> has ceased, <code>pymc3</code> now uses <code>aesara</code> for tensor calculations.</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>taxon_id, taxon_map <span class="op">=</span> df[<span class="st">&#39;taxon&#39;</span>].factorize(sort<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>n_taxon <span class="op">=</span> taxon_map.size</span></code></pre></div>
<div class="sourceCode" id="cb13"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>taxon_id_ <span class="op">=</span> shared(taxon_id)</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>log_age_ <span class="op">=</span> shared(log_age)</span></code></pre></div>
<p>Given the second observation above, we will actually specify one model per taxon (hence the adjective “unpooled”). This model has regression coefficients</p>
<p><span class="math display">\[
\begin{align*}
    a_j &amp; \sim N(0, 2.5^2) \\
    b_j &amp; \sim N(0, 2.5^2).
\end{align*}
\]</span></p>
<div class="sourceCode" id="cb14"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> pm.Model() <span class="im">as</span> loglin_model:</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>    a <span class="op">=</span> pm.Normal(<span class="st">&quot;a&quot;</span>, <span class="fl">0.</span>, <span class="fl">2.5</span>, shape<span class="op">=</span>n_taxon)</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>    b <span class="op">=</span> pm.Normal(<span class="st">&quot;b&quot;</span>, <span class="fl">0.</span>, <span class="fl">2.5</span>, shape<span class="op">=</span>n_taxon)</span></code></pre></div>
<p>Note that these prior differs differ slightly (in their variance) from those in the <em>BSM</em>. Nevertheless, the results will be quite similar. With the prior on <span class="math inline">\(\sigma_j \sim N(0, 2.5^2)\)</span>, we can finish specifying the model in code.</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> loglin_model:</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>    σ <span class="op">=</span> pm.HalfNormal(<span class="st">&quot;σ&quot;</span>, <span class="fl">2.5</span>, shape<span class="op">=</span>n_taxon)</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>    μ <span class="op">=</span> a[taxon_id_] <span class="op">+</span> b[taxon_id_] <span class="op">*</span> log_age_ <span class="op">-</span> <span class="fl">0.5</span> <span class="op">*</span> σ[taxon_id_]<span class="op">**</span><span class="dv">2</span></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>    obs <span class="op">=</span> pm.Normal(<span class="st">&quot;obs&quot;</span>, μ, σ[taxon_id_], observed<span class="op">=</span>log_mass)</span></code></pre></div>
<p>We now sample from the posterior distribution of the model.</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>CHAINS <span class="op">=</span> <span class="dv">3</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>DRAWS <span class="op">=</span> <span class="dv">2000</span></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>SEED <span class="op">=</span> <span class="dv">12345</span> <span class="co"># for reproducibility</span></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>SAMPLE_KWARGS <span class="op">=</span> {</span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;cores&#39;</span>: CHAINS,</span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;draws&#39;</span>: DRAWS,</span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;random_seed&#39;</span>: [SEED <span class="op">+</span> i <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(CHAINS)],</span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;return_inferencedata&#39;</span>: <span class="va">True</span>,</span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;target_accept&#39;</span>: <span class="fl">0.995</span></span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<div class="sourceCode" id="cb17"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> loglin_model:</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>    loglin_trace <span class="op">=</span> pm.sample(<span class="op">**</span>SAMPLE_KWARGS)</span></code></pre></div>
<pre><code>Auto-assigning NUTS sampler...
Initializing NUTS using jitter+adapt_diag...
Multiprocess sampling (3 chains in 3 jobs)
NUTS: [σ, b, a]</code></pre>
<div>
<style>
/* Turns off some styling */
progress {
/* gets rid of default border in Firefox and Opera. */
border: none;
/* Needs to be in here for Safari polyfill so background images work as expected. */
background-size: auto;
}
.progress-bar-interrupted, .progress-bar-interrupted::-webkit-progress-bar {
background: #F44336;
}
</style>
<progress value="9000" class max="9000" style="width:300px; height:20px; vertical-align: middle;">
</progress>
<p>100.00% [9000/9000 03:15&lt;00:00 Sampling 3 chains, 0 divergences]</p>
</div>
<pre><code>Sampling 3 chains for 1_000 tune and 2_000 draw iterations (3_000 + 6_000 draws total) took 198 seconds.
The number of effective samples is smaller than 25% for some parameters.</code></pre>
<p>To check that there is no obvious problem with our samples we check the energy plot, Bayesian fraction of missing information (BFMI), and <a href="https://blog.stata.com/2016/05/26/gelman-rubin-convergence-diagnostic-using-multiple-chains/">Gelman-Rubin statistics</a>.</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>az.plot_energy(loglin_trace)<span class="op">;</span></span></code></pre></div>
<center>
<img src="/resources/tyrannosaurid/Growth%20Curves%20REPARAM_29_0.png" title="fig:" alt="png" />
</center>
<p>Since the marginal and transitional energy distributions are similar and each BFMI is greater than 0.2, these diagnostics show no obvious issues.</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>az.rhat(loglin_trace).<span class="bu">max</span>()</span></code></pre></div>
<div>
<svg style="position: absolute; width: 0; height: 0; overflow: hidden">
<defs> <symbol id="icon-database" viewBox="0 0 32 32"> <path d="M16 0c-8.837 0-16 2.239-16 5v4c0 2.761 7.163 5 16 5s16-2.239 16-5v-4c0-2.761-7.163-5-16-5z"></path> <path d="M16 17c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z"></path> <path d="M16 26c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z"></path> </symbol> <symbol id="icon-file-text2" viewBox="0 0 32 32"> <path d="M28.681 7.159c-0.694-0.947-1.662-2.053-2.724-3.116s-2.169-2.030-3.116-2.724c-1.612-1.182-2.393-1.319-2.841-1.319h-15.5c-1.378 0-2.5 1.121-2.5 2.5v27c0 1.378 1.122 2.5 2.5 2.5h23c1.378 0 2.5-1.122 2.5-2.5v-19.5c0-0.448-0.137-1.23-1.319-2.841zM24.543 5.457c0.959 0.959 1.712 1.825 2.268 2.543h-4.811v-4.811c0.718 0.556 1.584 1.309 2.543 2.268zM28 29.5c0 0.271-0.229 0.5-0.5 0.5h-23c-0.271 0-0.5-0.229-0.5-0.5v-27c0-0.271 0.229-0.5 0.5-0.5 0 0 15.499-0 15.5 0v7c0 0.552 0.448 1 1 1h7v19.5z"></path> <path d="M23 26h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path> <path d="M23 22h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path> <path d="M23 18h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path> </symbol> </defs>
</svg>
<style>/* CSS stylesheet for displaying xarray objects in jupyterlab.
 *
 */

:root {
  --xr-font-color0: var(--jp-content-font-color0, rgba(0, 0, 0, 1));
  --xr-font-color2: var(--jp-content-font-color2, rgba(0, 0, 0, 0.54));
  --xr-font-color3: var(--jp-content-font-color3, rgba(0, 0, 0, 0.38));
  --xr-border-color: var(--jp-border-color2, #e0e0e0);
  --xr-disabled-color: var(--jp-layout-color3, #bdbdbd);
  --xr-background-color: var(--jp-layout-color0, white);
  --xr-background-color-row-even: var(--jp-layout-color1, white);
  --xr-background-color-row-odd: var(--jp-layout-color2, #eeeeee);
}

html[theme=dark],
body.vscode-dark {
  --xr-font-color0: rgba(255, 255, 255, 1);
  --xr-font-color2: rgba(255, 255, 255, 0.54);
  --xr-font-color3: rgba(255, 255, 255, 0.38);
  --xr-border-color: #1F1F1F;
  --xr-disabled-color: #515151;
  --xr-background-color: #111111;
  --xr-background-color-row-even: #111111;
  --xr-background-color-row-odd: #313131;
}

.xr-wrap {
  display: block;
  min-width: 300px;
  max-width: 700px;
}

.xr-text-repr-fallback {
  /* fallback to plain text repr when CSS is not injected (untrusted notebook) */
  display: none;
}

.xr-header {
  padding-top: 6px;
  padding-bottom: 6px;
  margin-bottom: 4px;
  border-bottom: solid 1px var(--xr-border-color);
}

.xr-header > div,
.xr-header > ul {
  display: inline;
  margin-top: 0;
  margin-bottom: 0;
}

.xr-obj-type,
.xr-array-name {
  margin-left: 2px;
  margin-right: 10px;
}

.xr-obj-type {
  color: var(--xr-font-color2);
}

.xr-sections {
  padding-left: 0 !important;
  display: grid;
  grid-template-columns: 150px auto auto 1fr 20px 20px;
}

.xr-section-item {
  display: contents;
}

.xr-section-item input {
  display: none;
}

.xr-section-item input + label {
  color: var(--xr-disabled-color);
}

.xr-section-item input:enabled + label {
  cursor: pointer;
  color: var(--xr-font-color2);
}

.xr-section-item input:enabled + label:hover {
  color: var(--xr-font-color0);
}

.xr-section-summary {
  grid-column: 1;
  color: var(--xr-font-color2);
  font-weight: 500;
}

.xr-section-summary > span {
  display: inline-block;
  padding-left: 0.5em;
}

.xr-section-summary-in:disabled + label {
  color: var(--xr-font-color2);
}

.xr-section-summary-in + label:before {
  display: inline-block;
  content: '►';
  font-size: 11px;
  width: 15px;
  text-align: center;
}

.xr-section-summary-in:disabled + label:before {
  color: var(--xr-disabled-color);
}

.xr-section-summary-in:checked + label:before {
  content: '▼';
}

.xr-section-summary-in:checked + label > span {
  display: none;
}

.xr-section-summary,
.xr-section-inline-details {
  padding-top: 4px;
  padding-bottom: 4px;
}

.xr-section-inline-details {
  grid-column: 2 / -1;
}

.xr-section-details {
  display: none;
  grid-column: 1 / -1;
  margin-bottom: 5px;
}

.xr-section-summary-in:checked ~ .xr-section-details {
  display: contents;
}

.xr-array-wrap {
  grid-column: 1 / -1;
  display: grid;
  grid-template-columns: 20px auto;
}

.xr-array-wrap > label {
  grid-column: 1;
  vertical-align: top;
}

.xr-preview {
  color: var(--xr-font-color3);
}

.xr-array-preview,
.xr-array-data {
  padding: 0 5px !important;
  grid-column: 2;
}

.xr-array-data,
.xr-array-in:checked ~ .xr-array-preview {
  display: none;
}

.xr-array-in:checked ~ .xr-array-data,
.xr-array-preview {
  display: inline-block;
}

.xr-dim-list {
  display: inline-block !important;
  list-style: none;
  padding: 0 !important;
  margin: 0;
}

.xr-dim-list li {
  display: inline-block;
  padding: 0;
  margin: 0;
}

.xr-dim-list:before {
  content: '(';
}

.xr-dim-list:after {
  content: ')';
}

.xr-dim-list li:not(:last-child):after {
  content: ',';
  padding-right: 5px;
}

.xr-has-index {
  font-weight: bold;
}

.xr-var-list,
.xr-var-item {
  display: contents;
}

.xr-var-item > div,
.xr-var-item label,
.xr-var-item > .xr-var-name span {
  background-color: var(--xr-background-color-row-even);
  margin-bottom: 0;
}

.xr-var-item > .xr-var-name:hover span {
  padding-right: 5px;
}

.xr-var-list > li:nth-child(odd) > div,
.xr-var-list > li:nth-child(odd) > label,
.xr-var-list > li:nth-child(odd) > .xr-var-name span {
  background-color: var(--xr-background-color-row-odd);
}

.xr-var-name {
  grid-column: 1;
}

.xr-var-dims {
  grid-column: 2;
}

.xr-var-dtype {
  grid-column: 3;
  text-align: right;
  color: var(--xr-font-color2);
}

.xr-var-preview {
  grid-column: 4;
}

.xr-var-name,
.xr-var-dims,
.xr-var-dtype,
.xr-preview,
.xr-attrs dt {
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  padding-right: 10px;
}

.xr-var-name:hover,
.xr-var-dims:hover,
.xr-var-dtype:hover,
.xr-attrs dt:hover {
  overflow: visible;
  width: auto;
  z-index: 1;
}

.xr-var-attrs,
.xr-var-data {
  display: none;
  background-color: var(--xr-background-color) !important;
  padding-bottom: 5px !important;
}

.xr-var-attrs-in:checked ~ .xr-var-attrs,
.xr-var-data-in:checked ~ .xr-var-data {
  display: block;
}

.xr-var-data > table {
  float: right;
}

.xr-var-name span,
.xr-var-data,
.xr-attrs {
  padding-left: 25px !important;
}

.xr-attrs,
.xr-var-attrs,
.xr-var-data {
  grid-column: 1 / -1;
}

dl.xr-attrs {
  padding: 0;
  margin: 0;
  display: grid;
  grid-template-columns: 125px auto;
}

.xr-attrs dt,
.xr-attrs dd {
  padding: 0;
  margin: 0;
  float: left;
  padding-right: 10px;
  width: auto;
}

.xr-attrs dt {
  font-weight: normal;
  grid-column: 1;
}

.xr-attrs dt:hover span {
  display: inline-block;
  background: var(--xr-background-color);
  padding-right: 10px;
}

.xr-attrs dd {
  grid-column: 2;
  white-space: pre-wrap;
  word-break: break-all;
}

.xr-icon-database,
.xr-icon-file-text2 {
  display: inline-block;
  vertical-align: middle;
  width: 1em;
  height: 1.5em !important;
  stroke-width: 0;
  stroke: currentColor;
  fill: currentColor;
}
</style>
<pre class='xr-text-repr-fallback'>&lt;xarray.Dataset&gt;
Dimensions:  ()
Data variables:
    a        float64 1.008
    b        float64 1.006
    σ        float64 1.003</pre>
<div class="xr-wrap" hidden="">
<div class="xr-header">
<div class="xr-obj-type">
xarray.Dataset
</div>
</div>
<ul class="xr-sections">
<li class="xr-section-item">
<input id='section-d9e06707-038b-4547-aa09-f1cf96a4318a' class='xr-section-summary-in' type='checkbox' disabled ><label for='section-d9e06707-038b-4547-aa09-f1cf96a4318a' class='xr-section-summary'  title='Expand/collapse section'>Dimensions:</label>
<div class="xr-section-inline-details">

</div>
<div class="xr-section-details">

</div>
</li>
<li class="xr-section-item">
<input id='section-afd5b947-fc86-488c-993c-ed479c22e3e0' class='xr-section-summary-in' type='checkbox' disabled ><label for='section-afd5b947-fc86-488c-993c-ed479c22e3e0' class='xr-section-summary'  title='Expand/collapse section'>Coordinates: <span>(0)</span></label>
<div class="xr-section-inline-details">

</div>
<div class="xr-section-details">
<ul class="xr-var-list">
</ul>
</div>
</li>
<li class="xr-section-item">
<input id='section-2eb92c91-1d1d-4091-92a8-510f97f64f02' class='xr-section-summary-in' type='checkbox'  checked><label for='section-2eb92c91-1d1d-4091-92a8-510f97f64f02' class='xr-section-summary' >Data variables: <span>(3)</span></label>
<div class="xr-section-inline-details">

</div>
<div class="xr-section-details">
<ul class="xr-var-list">
<li class="xr-var-item">
<div class="xr-var-name">
<span>a</span>
</div>
<div class="xr-var-dims">
()
</div>
<div class="xr-var-dtype">
float64
</div>
<div class="xr-var-preview xr-preview">
1.008
</div>
<input id='attrs-f5a1c8f7-526e-42bf-8395-82c7d65893e0' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-f5a1c8f7-526e-42bf-8395-82c7d65893e0' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-000f63d2-b8b9-4cf2-895a-4975bb34a926' class='xr-var-data-in' type='checkbox'><label for='data-000f63d2-b8b9-4cf2-895a-4975bb34a926' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label>
<div class="xr-var-attrs">
<dl class="xr-attrs">
</dl>
</div>
<div class="xr-var-data">
<pre>array(1.00765472)</pre>
</div>
</li>
<li class="xr-var-item">
<div class="xr-var-name">
<span>b</span>
</div>
<div class="xr-var-dims">
()
</div>
<div class="xr-var-dtype">
float64
</div>
<div class="xr-var-preview xr-preview">
1.006
</div>
<input id='attrs-19ae3b16-7c53-411f-83f0-85927783274e' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-19ae3b16-7c53-411f-83f0-85927783274e' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-aaec7ffc-0f99-49c9-82d0-62f746b4eb58' class='xr-var-data-in' type='checkbox'><label for='data-aaec7ffc-0f99-49c9-82d0-62f746b4eb58' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label>
<div class="xr-var-attrs">
<dl class="xr-attrs">
</dl>
</div>
<div class="xr-var-data">
<pre>array(1.00622094)</pre>
</div>
</li>
<li class="xr-var-item">
<div class="xr-var-name">
<span>σ</span>
</div>
<div class="xr-var-dims">
()
</div>
<div class="xr-var-dtype">
float64
</div>
<div class="xr-var-preview xr-preview">
1.003
</div>
<input id='attrs-f0e8ab0c-5ff7-4eb3-9e57-61767b7163d7' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-f0e8ab0c-5ff7-4eb3-9e57-61767b7163d7' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-4b49b11e-b070-47ba-9498-ea18a0051736' class='xr-var-data-in' type='checkbox'><label for='data-4b49b11e-b070-47ba-9498-ea18a0051736' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label>
<div class="xr-var-attrs">
<dl class="xr-attrs">
</dl>
</div>
<div class="xr-var-data">
<pre>array(1.00281897)</pre>
</div>
</li>
</ul>
</div>
</li>
<li class="xr-section-item">
<input id='section-655ba6c6-33eb-47dd-9d60-e57af97dca0b' class='xr-section-summary-in' type='checkbox' disabled ><label for='section-655ba6c6-33eb-47dd-9d60-e57af97dca0b' class='xr-section-summary'  title='Expand/collapse section'>Attributes: <span>(0)</span></label>
<div class="xr-section-inline-details">

</div>
<div class="xr-section-details">
<dl class="xr-attrs">
</dl>
</div>
</li>
</ul>
</div>
</div>
<p>The Gelman-Rubin statistics for each parameter are acceptable (smaller than 1.05) as well.</p>
<p>We now draw samples from the posterior predictive distribution of <span class="math inline">\(Y\)</span>. First we build a grid for <span class="math inline">\(x\)</span> (<code>pp_log_age</code>) and <span class="math inline">\(j\)</span> (<code>pp_taxon_id</code>) that span the observed range of these quantities in the data.</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>pp_log_age <span class="op">=</span> np.repeat(np.linspace(<span class="dv">0</span>, np.log(<span class="dv">30</span>)), n_taxon)</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>pp_taxon_id <span class="op">=</span> np.tile(np.arange(n_taxon), pp_log_age.size <span class="op">//</span> n_taxon)</span></code></pre></div>
<p>Now we sample from the posterior predictive distribution.</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>ALPHA <span class="op">=</span> <span class="fl">0.05</span></span></code></pre></div>
<div class="sourceCode" id="cb24"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> get_pp_df(model, trace, alpha<span class="op">=</span>ALPHA):</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>    taxon_id_.set_value(pp_taxon_id)</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>    log_age_.set_value(pp_log_age)</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">with</span> model:</span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>        pp_trace <span class="op">=</span> pm.sample_posterior_predictive(trace)</span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>    taxon_id_.set_value(taxon_id)</span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a>    log_age_.set_value(log_age)</span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> pd.DataFrame({</span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a>        <span class="st">&#39;age&#39;</span>: np.exp(pp_log_age),</span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true" tabindex="-1"></a>        <span class="st">&#39;taxon_id&#39;</span>: pp_taxon_id,</span>
<span id="cb24-14"><a href="#cb24-14" aria-hidden="true" tabindex="-1"></a>        <span class="st">&#39;pp_mean&#39;</span>: np.exp(pp_trace[<span class="st">&#39;obs&#39;</span>].mean(axis<span class="op">=</span><span class="dv">0</span>)),</span>
<span id="cb24-15"><a href="#cb24-15" aria-hidden="true" tabindex="-1"></a>        <span class="st">&#39;pp_low&#39;</span>: np.exp(np.percentile(pp_trace[<span class="st">&#39;obs&#39;</span>], <span class="dv">100</span> <span class="op">*</span> alpha <span class="op">/</span> <span class="fl">2.</span>, axis<span class="op">=</span><span class="dv">0</span>)),</span>
<span id="cb24-16"><a href="#cb24-16" aria-hidden="true" tabindex="-1"></a>        <span class="st">&#39;pp_high&#39;</span>: np.exp(np.percentile(pp_trace[<span class="st">&#39;obs&#39;</span>], <span class="dv">100</span> <span class="op">*</span> (<span class="dv">1</span> <span class="op">-</span> alpha <span class="op">/</span> <span class="fl">2.</span>), axis<span class="op">=</span><span class="dv">0</span>))</span>
<span id="cb24-17"><a href="#cb24-17" aria-hidden="true" tabindex="-1"></a>    })</span></code></pre></div>
<p>Note the lines in <code>get_pp_df</code> where we change the values of the <code>shared</code> variables <code>taxon_id_</code> and <code>log_age_</code> to their posterior predictive grid values before sampling and back to the observed values after sampling.</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>pp_loglin_df <span class="op">=</span> get_pp_df(loglin_model, loglin_trace)</span></code></pre></div>
<div>
<style>
/* Turns off some styling */
progress {
/* gets rid of default border in Firefox and Opera. */
border: none;
/* Needs to be in here for Safari polyfill so background images work as expected. */
background-size: auto;
}
.progress-bar-interrupted, .progress-bar-interrupted::-webkit-progress-bar {
background: #F44336;
}
</style>
<progress value="6000" class max="6000" style="width:300px; height:20px; vertical-align: middle;">
</progress>
<p>100.00% [6000/6000 00:31&lt;00:00]</p>
</div>
<div class="sourceCode" id="cb26"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>pp_loglin_df.head()</span></code></pre></div>
<center>
<div>
<style scoped>
.dataframe tbody tr th:only-of-type {
    vertical-align: middle;
}

.dataframe tbody tr th {
    vertical-align: top;
}

.dataframe thead th {
    text-align: right;
}
</style>
<table border="1" class="dataframe">
<thead>
<tr style="text-align: right;">
<th>
</th>
<th>
age
</th>
<th>
taxon_id
</th>
<th>
pp_mean
</th>
<th>
pp_low
</th>
<th>
pp_high
</th>
</tr>
</thead>
<tbody>
<tr>
<th>
0
</th>
<td>
1.000000
</td>
<td>
0
</td>
<td>
19.767345
</td>
<td>
7.513964
</td>
<td>
44.358809
</td>
</tr>
<tr>
<th>
1
</th>
<td>
1.000000
</td>
<td>
1
</td>
<td>
3.751587
</td>
<td>
0.029910
</td>
<td>
96.423621
</td>
</tr>
<tr>
<th>
2
</th>
<td>
1.000000
</td>
<td>
2
</td>
<td>
8.544977
</td>
<td>
2.598875
</td>
<td>
22.385467
</td>
</tr>
<tr>
<th>
3
</th>
<td>
1.000000
</td>
<td>
3
</td>
<td>
7.263371
</td>
<td>
2.957169
</td>
<td>
17.696855
</td>
</tr>
<tr>
<th>
4
</th>
<td>
1.071878
</td>
<td>
0
</td>
<td>
21.720457
</td>
<td>
8.950703
</td>
<td>
48.788518
</td>
</tr>
</tbody>
</table>
</div>
</center>
<p><br></p>
<p>Finally, after all of this preparatory work, we get to the payoff and plot the posterior predictive means and intervals for each taxon across our grid.</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> make_posterior_mean_label(name):</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="st">&quot;Posterior mean&quot;</span> <span class="cf">if</span> name <span class="kw">is</span> <span class="va">None</span> <span class="cf">else</span> <span class="ss">f&quot;</span><span class="sc">{</span>name<span class="sc">}</span><span class="ch">\n</span><span class="ss">posterior mean&quot;</span></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> make_posterior_interval_label(name):</span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="st">&quot;95</span><span class="sc">% i</span><span class="st">nterval&quot;</span> <span class="cf">if</span> name <span class="kw">is</span> <span class="va">None</span> <span class="cf">else</span> <span class="ss">f&quot;</span><span class="sc">{</span>name<span class="sc">}</span><span class="ch">\n</span><span class="ss">95% interval&quot;</span></span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> plot_taxon_posterior(taxon, df, pp_df,</span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a>                         name<span class="op">=</span><span class="va">None</span>, plot_data<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a>                         legend<span class="op">=</span><span class="va">True</span>, ax<span class="op">=</span><span class="va">None</span>):</span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> ax <span class="kw">is</span> <span class="va">None</span>:</span>
<span id="cb27-11"><a href="#cb27-11" aria-hidden="true" tabindex="-1"></a>        fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">8</span>, <span class="dv">6</span>))</span>
<span id="cb27-12"><a href="#cb27-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-13"><a href="#cb27-13" aria-hidden="true" tabindex="-1"></a>    ax.fill_between(pp_df[<span class="st">&#39;age&#39;</span>], pp_df[<span class="st">&#39;pp_low&#39;</span>], pp_df[<span class="st">&#39;pp_high&#39;</span>],</span>
<span id="cb27-14"><a href="#cb27-14" aria-hidden="true" tabindex="-1"></a>                    alpha<span class="op">=</span><span class="fl">0.25</span>, label<span class="op">=</span>make_posterior_interval_label(name))<span class="op">;</span></span>
<span id="cb27-15"><a href="#cb27-15" aria-hidden="true" tabindex="-1"></a>    pp_df.plot(<span class="st">&#39;age&#39;</span>, <span class="st">&#39;pp_mean&#39;</span>, label<span class="op">=</span>make_posterior_mean_label(name), ax<span class="op">=</span>ax)</span>
<span id="cb27-16"><a href="#cb27-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-17"><a href="#cb27-17" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> plot_data:</span>
<span id="cb27-18"><a href="#cb27-18" aria-hidden="true" tabindex="-1"></a>        df.plot.scatter(<span class="st">&#39;age&#39;</span>, <span class="st">&#39;mass&#39;</span>, c<span class="op">=</span><span class="st">&#39;C0&#39;</span>, label<span class="op">=</span><span class="st">&quot;Data&quot;</span>, ax<span class="op">=</span>ax)</span>
<span id="cb27-19"><a href="#cb27-19" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb27-20"><a href="#cb27-20" aria-hidden="true" tabindex="-1"></a>    ax.set_title(taxon)</span>
<span id="cb27-21"><a href="#cb27-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-22"><a href="#cb27-22" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> legend:</span>
<span id="cb27-23"><a href="#cb27-23" aria-hidden="true" tabindex="-1"></a>        ax.legend(loc<span class="op">=</span><span class="dv">2</span>)</span>
<span id="cb27-24"><a href="#cb27-24" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb27-25"><a href="#cb27-25" aria-hidden="true" tabindex="-1"></a>        ax.get_legend().remove()</span>
<span id="cb27-26"><a href="#cb27-26" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb27-27"><a href="#cb27-27" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> ax</span></code></pre></div>
<div class="sourceCode" id="cb28"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>FIGSIZE <span class="op">=</span> (<span class="dv">12</span>, <span class="dv">9</span>)</span></code></pre></div>
<div class="sourceCode" id="cb29"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> plot_pp_by_taxon(pp_df,</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>                     name<span class="op">=</span><span class="va">None</span>, plot_data<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>                     fig<span class="op">=</span><span class="va">None</span>, axes<span class="op">=</span><span class="va">None</span>, figsize<span class="op">=</span>FIGSIZE):</span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> fig <span class="kw">is</span> <span class="va">None</span> <span class="kw">or</span> axes <span class="kw">is</span> <span class="va">None</span>:</span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>        fig, axes <span class="op">=</span> plt.subplots(nrows<span class="op">=</span><span class="dv">2</span>, ncols<span class="op">=</span><span class="dv">2</span>, sharex<span class="op">=</span><span class="va">True</span>, sharey<span class="op">=</span><span class="va">True</span>, figsize<span class="op">=</span>figsize)</span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> plt_taxon_id, ax <span class="kw">in</span> <span class="bu">enumerate</span>(axes.flatten()):</span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a>        taxon <span class="op">=</span> taxon_map[plt_taxon_id]</span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a>        taxon_df <span class="op">=</span> df[taxon_id <span class="op">==</span> plt_taxon_id]</span>
<span id="cb29-10"><a href="#cb29-10" aria-hidden="true" tabindex="-1"></a>        taxon_pp_df <span class="op">=</span> pp_df[pp_df[<span class="st">&#39;taxon_id&#39;</span>] <span class="op">==</span> plt_taxon_id]</span>
<span id="cb29-11"><a href="#cb29-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-12"><a href="#cb29-12" aria-hidden="true" tabindex="-1"></a>        plot_taxon_posterior(taxon, taxon_df, taxon_pp_df,</span>
<span id="cb29-13"><a href="#cb29-13" aria-hidden="true" tabindex="-1"></a>                             name<span class="op">=</span>name, plot_data<span class="op">=</span>plot_data,</span>
<span id="cb29-14"><a href="#cb29-14" aria-hidden="true" tabindex="-1"></a>                             legend<span class="op">=</span>(plt_taxon_id <span class="op">==</span> <span class="dv">0</span>), ax<span class="op">=</span>ax)</span>
<span id="cb29-15"><a href="#cb29-15" aria-hidden="true" tabindex="-1"></a>        ax.set_xlim(right<span class="op">=</span><span class="dv">30</span>)</span>
<span id="cb29-16"><a href="#cb29-16" aria-hidden="true" tabindex="-1"></a>        ax.set_ylim(top<span class="op">=</span><span class="dv">6000</span>)</span>
<span id="cb29-17"><a href="#cb29-17" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb29-18"><a href="#cb29-18" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> fig, axes</span></code></pre></div>
<div class="sourceCode" id="cb30"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>plot_pp_by_taxon(pp_loglin_df)<span class="op">;</span></span></code></pre></div>
<center>
<img src="/resources/tyrannosaurid/Growth%20Curves%20REPARAM_44_0.png" title="fig:" alt="png" />
</center>
<p>Visually comparing these plots to the corresponding ones in the worked JAGS example shows reasonable agreement in spite of our slightly different prior specification.</p>
<h3 id="pooled-log-linear-model">Pooled log-linear model</h3>
<p>It is quite noticeable that in the above posterior predictive plots that the credible intervals are wider for taxa that have fewer data points. In particular there are only three samples of taxon Daspletosaurus. A hierarchical model will allow us to share information from taxa with more observations when inferring the posterior distributions of parameters for taxa with fewer observations. This information sharing leads to the use of the term “pooled” for this type of model. The pooled log linear model still takes the form</p>
<p><span class="math display">\[\log\left(f_j(X)\right) = a_j + b_j \log X,\]</span></p>
<p>but uses different priors on <span class="math inline">\(a_j\)</span> and <span class="math inline">\(b_j\)</span>. Conceptually, the pooled model uses the priors</p>
<p><span class="math display">\[
\begin{align*}
    \mu_a
        &amp; \sim N(0, 2.5^2) \\
    \sigma_a
        &amp; \sim \textrm{HalfNormal}(2.5^2) \\
    a_j
        &amp; \sim N(\mu_a, \sigma_a^2),
\end{align*}
\]</span></p>
<p>and similarly for <span class="math inline">\(b_j\)</span>.</p>
<p>In reality, this intuitive parameterization can often present <a href="https://twiecki.io/blog/2017/02/08/bayesian-hierchical-non-centered/">computational challenges</a>, so we use the following non-centered parameterization instead.</p>
<p><span class="math display">\[
\begin{align*}
    \mu_a
        &amp; \sim N(0, 2.5^2) \\
    \Delta_{a_j}
        &amp; \sim N(0, 1) \\
    \sigma_a
        &amp; \sim \textrm{HalfNormal}(2.5^2) \\
    a_j
        &amp; = \mu_a + \Delta_{a_j} \cdot \sigma_a.
\end{align*}
\]</span></p>
<div class="sourceCode" id="cb31"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> hierarchical_normal(name, shape):</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>    μ <span class="op">=</span> pm.Normal(<span class="ss">f&quot;μ_</span><span class="sc">{</span>name<span class="sc">}</span><span class="ss">&quot;</span>, <span class="fl">0.</span>, <span class="fl">2.5</span>)</span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>    Δ <span class="op">=</span> pm.Normal(<span class="ss">f&quot;Δ_</span><span class="sc">{</span>name<span class="sc">}</span><span class="ss">&quot;</span>, <span class="fl">0.</span>, <span class="fl">1.</span>, shape<span class="op">=</span>shape)</span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>    σ <span class="op">=</span> pm.HalfNormal(<span class="ss">f&quot;σ_</span><span class="sc">{</span>name<span class="sc">}</span><span class="ss">&quot;</span>, <span class="fl">2.5</span>)</span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> pm.Deterministic(name, μ <span class="op">+</span> Δ <span class="op">*</span> σ)</span></code></pre></div>
<div class="sourceCode" id="cb32"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> pm.Model() <span class="im">as</span> pooled_loglin_model:</span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>    a <span class="op">=</span> hierarchical_normal(<span class="st">&quot;a&quot;</span>, n_taxon)</span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>    b <span class="op">=</span> hierarchical_normal(<span class="st">&quot;b&quot;</span>, n_taxon)</span></code></pre></div>
<p>To further share information across taxa, we enforce the constraint that the noise parameters are identical across taxa, <span class="math inline">\(\sigma_1 = \sigma_2 = \sigma_3 = \sigma_4 = \sigma\)</span>, with the prior <span class="math inline">\(\sigma \sim \textrm{HalfNormal}(2.5^2)\)</span>.</p>
<div class="sourceCode" id="cb33"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> pooled_loglin_model:</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>    σ <span class="op">=</span> pm.HalfNormal(<span class="st">&quot;σ&quot;</span>, <span class="fl">2.5</span>)</span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>    μ <span class="op">=</span> a[taxon_id_] <span class="op">+</span> b[taxon_id_] <span class="op">*</span> log_age_ <span class="op">-</span> <span class="fl">0.5</span> <span class="op">*</span> σ<span class="op">**</span><span class="dv">2</span></span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a>    obs <span class="op">=</span> pm.Normal(<span class="st">&quot;obs&quot;</span>, μ, σ, observed<span class="op">=</span>log_mass)</span></code></pre></div>
<p>We now sample from the pooled log-linear model.</p>
<div class="sourceCode" id="cb34"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> pooled_loglin_model:</span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>    pooled_loglin_trace <span class="op">=</span> pm.sample(<span class="op">**</span>SAMPLE_KWARGS)</span></code></pre></div>
<pre><code>Auto-assigning NUTS sampler...
Initializing NUTS using jitter+adapt_diag...
Multiprocess sampling (3 chains in 3 jobs)
NUTS: [σ, σ_b, Δ_b, μ_b, σ_a, Δ_a, μ_a]</code></pre>
<div>
<style>
/* Turns off some styling */
progress {
/* gets rid of default border in Firefox and Opera. */
border: none;
/* Needs to be in here for Safari polyfill so background images work as expected. */
background-size: auto;
}
.progress-bar-interrupted, .progress-bar-interrupted::-webkit-progress-bar {
background: #F44336;
}
</style>
<progress value="9000" class max="9000" style="width:300px; height:20px; vertical-align: middle;">
</progress>
<p>100.00% [9000/9000 08:33&lt;00:00 Sampling 3 chains, 0 divergences]</p>
</div>
<pre><code>Sampling 3 chains for 1_000 tune and 2_000 draw iterations (3_000 + 6_000 draws total) took 514 seconds.
The number of effective samples is smaller than 25% for some parameters.</code></pre>
<p>Again our diagnostics show no obvious cause for concern.</p>
<div class="sourceCode" id="cb37"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>az.plot_energy(pooled_loglin_trace)<span class="op">;</span></span></code></pre></div>
<center>
<img src="/resources/tyrannosaurid/Growth%20Curves%20REPARAM_54_0.png" title="fig:" alt="png" />
</center>
<div class="sourceCode" id="cb38"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>az.rhat(pooled_loglin_trace).<span class="bu">max</span>()</span></code></pre></div>
<div>
<svg style="position: absolute; width: 0; height: 0; overflow: hidden">
<defs> <symbol id="icon-database" viewBox="0 0 32 32"> <path d="M16 0c-8.837 0-16 2.239-16 5v4c0 2.761 7.163 5 16 5s16-2.239 16-5v-4c0-2.761-7.163-5-16-5z"></path> <path d="M16 17c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z"></path> <path d="M16 26c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z"></path> </symbol> <symbol id="icon-file-text2" viewBox="0 0 32 32"> <path d="M28.681 7.159c-0.694-0.947-1.662-2.053-2.724-3.116s-2.169-2.030-3.116-2.724c-1.612-1.182-2.393-1.319-2.841-1.319h-15.5c-1.378 0-2.5 1.121-2.5 2.5v27c0 1.378 1.122 2.5 2.5 2.5h23c1.378 0 2.5-1.122 2.5-2.5v-19.5c0-0.448-0.137-1.23-1.319-2.841zM24.543 5.457c0.959 0.959 1.712 1.825 2.268 2.543h-4.811v-4.811c0.718 0.556 1.584 1.309 2.543 2.268zM28 29.5c0 0.271-0.229 0.5-0.5 0.5h-23c-0.271 0-0.5-0.229-0.5-0.5v-27c0-0.271 0.229-0.5 0.5-0.5 0 0 15.499-0 15.5 0v7c0 0.552 0.448 1 1 1h7v19.5z"></path> <path d="M23 26h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path> <path d="M23 22h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path> <path d="M23 18h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path> </symbol> </defs>
</svg>
<style>/* CSS stylesheet for displaying xarray objects in jupyterlab.
 *
 */

:root {
  --xr-font-color0: var(--jp-content-font-color0, rgba(0, 0, 0, 1));
  --xr-font-color2: var(--jp-content-font-color2, rgba(0, 0, 0, 0.54));
  --xr-font-color3: var(--jp-content-font-color3, rgba(0, 0, 0, 0.38));
  --xr-border-color: var(--jp-border-color2, #e0e0e0);
  --xr-disabled-color: var(--jp-layout-color3, #bdbdbd);
  --xr-background-color: var(--jp-layout-color0, white);
  --xr-background-color-row-even: var(--jp-layout-color1, white);
  --xr-background-color-row-odd: var(--jp-layout-color2, #eeeeee);
}

html[theme=dark],
body.vscode-dark {
  --xr-font-color0: rgba(255, 255, 255, 1);
  --xr-font-color2: rgba(255, 255, 255, 0.54);
  --xr-font-color3: rgba(255, 255, 255, 0.38);
  --xr-border-color: #1F1F1F;
  --xr-disabled-color: #515151;
  --xr-background-color: #111111;
  --xr-background-color-row-even: #111111;
  --xr-background-color-row-odd: #313131;
}

.xr-wrap {
  display: block;
  min-width: 300px;
  max-width: 700px;
}

.xr-text-repr-fallback {
  /* fallback to plain text repr when CSS is not injected (untrusted notebook) */
  display: none;
}

.xr-header {
  padding-top: 6px;
  padding-bottom: 6px;
  margin-bottom: 4px;
  border-bottom: solid 1px var(--xr-border-color);
}

.xr-header > div,
.xr-header > ul {
  display: inline;
  margin-top: 0;
  margin-bottom: 0;
}

.xr-obj-type,
.xr-array-name {
  margin-left: 2px;
  margin-right: 10px;
}

.xr-obj-type {
  color: var(--xr-font-color2);
}

.xr-sections {
  padding-left: 0 !important;
  display: grid;
  grid-template-columns: 150px auto auto 1fr 20px 20px;
}

.xr-section-item {
  display: contents;
}

.xr-section-item input {
  display: none;
}

.xr-section-item input + label {
  color: var(--xr-disabled-color);
}

.xr-section-item input:enabled + label {
  cursor: pointer;
  color: var(--xr-font-color2);
}

.xr-section-item input:enabled + label:hover {
  color: var(--xr-font-color0);
}

.xr-section-summary {
  grid-column: 1;
  color: var(--xr-font-color2);
  font-weight: 500;
}

.xr-section-summary > span {
  display: inline-block;
  padding-left: 0.5em;
}

.xr-section-summary-in:disabled + label {
  color: var(--xr-font-color2);
}

.xr-section-summary-in + label:before {
  display: inline-block;
  content: '►';
  font-size: 11px;
  width: 15px;
  text-align: center;
}

.xr-section-summary-in:disabled + label:before {
  color: var(--xr-disabled-color);
}

.xr-section-summary-in:checked + label:before {
  content: '▼';
}

.xr-section-summary-in:checked + label > span {
  display: none;
}

.xr-section-summary,
.xr-section-inline-details {
  padding-top: 4px;
  padding-bottom: 4px;
}

.xr-section-inline-details {
  grid-column: 2 / -1;
}

.xr-section-details {
  display: none;
  grid-column: 1 / -1;
  margin-bottom: 5px;
}

.xr-section-summary-in:checked ~ .xr-section-details {
  display: contents;
}

.xr-array-wrap {
  grid-column: 1 / -1;
  display: grid;
  grid-template-columns: 20px auto;
}

.xr-array-wrap > label {
  grid-column: 1;
  vertical-align: top;
}

.xr-preview {
  color: var(--xr-font-color3);
}

.xr-array-preview,
.xr-array-data {
  padding: 0 5px !important;
  grid-column: 2;
}

.xr-array-data,
.xr-array-in:checked ~ .xr-array-preview {
  display: none;
}

.xr-array-in:checked ~ .xr-array-data,
.xr-array-preview {
  display: inline-block;
}

.xr-dim-list {
  display: inline-block !important;
  list-style: none;
  padding: 0 !important;
  margin: 0;
}

.xr-dim-list li {
  display: inline-block;
  padding: 0;
  margin: 0;
}

.xr-dim-list:before {
  content: '(';
}

.xr-dim-list:after {
  content: ')';
}

.xr-dim-list li:not(:last-child):after {
  content: ',';
  padding-right: 5px;
}

.xr-has-index {
  font-weight: bold;
}

.xr-var-list,
.xr-var-item {
  display: contents;
}

.xr-var-item > div,
.xr-var-item label,
.xr-var-item > .xr-var-name span {
  background-color: var(--xr-background-color-row-even);
  margin-bottom: 0;
}

.xr-var-item > .xr-var-name:hover span {
  padding-right: 5px;
}

.xr-var-list > li:nth-child(odd) > div,
.xr-var-list > li:nth-child(odd) > label,
.xr-var-list > li:nth-child(odd) > .xr-var-name span {
  background-color: var(--xr-background-color-row-odd);
}

.xr-var-name {
  grid-column: 1;
}

.xr-var-dims {
  grid-column: 2;
}

.xr-var-dtype {
  grid-column: 3;
  text-align: right;
  color: var(--xr-font-color2);
}

.xr-var-preview {
  grid-column: 4;
}

.xr-var-name,
.xr-var-dims,
.xr-var-dtype,
.xr-preview,
.xr-attrs dt {
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  padding-right: 10px;
}

.xr-var-name:hover,
.xr-var-dims:hover,
.xr-var-dtype:hover,
.xr-attrs dt:hover {
  overflow: visible;
  width: auto;
  z-index: 1;
}

.xr-var-attrs,
.xr-var-data {
  display: none;
  background-color: var(--xr-background-color) !important;
  padding-bottom: 5px !important;
}

.xr-var-attrs-in:checked ~ .xr-var-attrs,
.xr-var-data-in:checked ~ .xr-var-data {
  display: block;
}

.xr-var-data > table {
  float: right;
}

.xr-var-name span,
.xr-var-data,
.xr-attrs {
  padding-left: 25px !important;
}

.xr-attrs,
.xr-var-attrs,
.xr-var-data {
  grid-column: 1 / -1;
}

dl.xr-attrs {
  padding: 0;
  margin: 0;
  display: grid;
  grid-template-columns: 125px auto;
}

.xr-attrs dt,
.xr-attrs dd {
  padding: 0;
  margin: 0;
  float: left;
  padding-right: 10px;
  width: auto;
}

.xr-attrs dt {
  font-weight: normal;
  grid-column: 1;
}

.xr-attrs dt:hover span {
  display: inline-block;
  background: var(--xr-background-color);
  padding-right: 10px;
}

.xr-attrs dd {
  grid-column: 2;
  white-space: pre-wrap;
  word-break: break-all;
}

.xr-icon-database,
.xr-icon-file-text2 {
  display: inline-block;
  vertical-align: middle;
  width: 1em;
  height: 1.5em !important;
  stroke-width: 0;
  stroke: currentColor;
  fill: currentColor;
}
</style>
<pre class='xr-text-repr-fallback'>&lt;xarray.Dataset&gt;
Dimensions:  ()
Data variables:
    μ_a      float64 1.002
    Δ_a      float64 1.002
    μ_b      float64 1.0
    Δ_b      float64 1.001
    σ_a      float64 1.002
    a        float64 1.002
    σ_b      float64 1.004
    b        float64 1.002
    σ        float64 1.006</pre>
<div class="xr-wrap" hidden="">
<div class="xr-header">
<div class="xr-obj-type">
xarray.Dataset
</div>
</div>
<ul class="xr-sections">
<li class="xr-section-item">
<input id='section-3c17eb08-6762-42b7-b4bf-f54bd2a01e36' class='xr-section-summary-in' type='checkbox' disabled ><label for='section-3c17eb08-6762-42b7-b4bf-f54bd2a01e36' class='xr-section-summary'  title='Expand/collapse section'>Dimensions:</label>
<div class="xr-section-inline-details">

</div>
<div class="xr-section-details">

</div>
</li>
<li class="xr-section-item">
<input id='section-7ed7a115-a843-48eb-986b-a302a247aec5' class='xr-section-summary-in' type='checkbox' disabled ><label for='section-7ed7a115-a843-48eb-986b-a302a247aec5' class='xr-section-summary'  title='Expand/collapse section'>Coordinates: <span>(0)</span></label>
<div class="xr-section-inline-details">

</div>
<div class="xr-section-details">
<ul class="xr-var-list">
</ul>
</div>
</li>
<li class="xr-section-item">
<input id='section-02f91719-e66f-40a9-b6a0-c00a59519052' class='xr-section-summary-in' type='checkbox'  checked><label for='section-02f91719-e66f-40a9-b6a0-c00a59519052' class='xr-section-summary' >Data variables: <span>(9)</span></label>
<div class="xr-section-inline-details">

</div>
<div class="xr-section-details">
<ul class="xr-var-list">
<li class="xr-var-item">
<div class="xr-var-name">
<span>μ_a</span>
</div>
<div class="xr-var-dims">
()
</div>
<div class="xr-var-dtype">
float64
</div>
<div class="xr-var-preview xr-preview">
1.002
</div>
<input id='attrs-783bd763-2207-4a57-8294-36d92c44e147' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-783bd763-2207-4a57-8294-36d92c44e147' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-19bc9785-67c4-4ef1-a549-cc0ffd213b62' class='xr-var-data-in' type='checkbox'><label for='data-19bc9785-67c4-4ef1-a549-cc0ffd213b62' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label>
<div class="xr-var-attrs">
<dl class="xr-attrs">
</dl>
</div>
<div class="xr-var-data">
<pre>array(1.00208566)</pre>
</div>
</li>
<li class="xr-var-item">
<div class="xr-var-name">
<span>Δ_a</span>
</div>
<div class="xr-var-dims">
()
</div>
<div class="xr-var-dtype">
float64
</div>
<div class="xr-var-preview xr-preview">
1.002
</div>
<input id='attrs-460d97b2-4b7a-4506-ba44-7b95f06d5df9' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-460d97b2-4b7a-4506-ba44-7b95f06d5df9' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-3926da15-bc20-4bf7-9726-ded6ad7fa50a' class='xr-var-data-in' type='checkbox'><label for='data-3926da15-bc20-4bf7-9726-ded6ad7fa50a' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label>
<div class="xr-var-attrs">
<dl class="xr-attrs">
</dl>
</div>
<div class="xr-var-data">
<pre>array(1.00184228)</pre>
</div>
</li>
<li class="xr-var-item">
<div class="xr-var-name">
<span>μ_b</span>
</div>
<div class="xr-var-dims">
()
</div>
<div class="xr-var-dtype">
float64
</div>
<div class="xr-var-preview xr-preview">
1.0
</div>
<input id='attrs-3f8fc75d-29b7-4a05-b5a2-40d8c1dac4eb' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-3f8fc75d-29b7-4a05-b5a2-40d8c1dac4eb' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-b890c5ff-8493-4852-81e0-b4653469b4ba' class='xr-var-data-in' type='checkbox'><label for='data-b890c5ff-8493-4852-81e0-b4653469b4ba' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label>
<div class="xr-var-attrs">
<dl class="xr-attrs">
</dl>
</div>
<div class="xr-var-data">
<pre>array(1.00044944)</pre>
</div>
</li>
<li class="xr-var-item">
<div class="xr-var-name">
<span>Δ_b</span>
</div>
<div class="xr-var-dims">
()
</div>
<div class="xr-var-dtype">
float64
</div>
<div class="xr-var-preview xr-preview">
1.001
</div>
<input id='attrs-f223db23-a2da-42be-9a01-c0b4b5ec5580' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-f223db23-a2da-42be-9a01-c0b4b5ec5580' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-a92d9930-694a-4a42-a044-0ec3198c4883' class='xr-var-data-in' type='checkbox'><label for='data-a92d9930-694a-4a42-a044-0ec3198c4883' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label>
<div class="xr-var-attrs">
<dl class="xr-attrs">
</dl>
</div>
<div class="xr-var-data">
<pre>array(1.00108353)</pre>
</div>
</li>
<li class="xr-var-item">
<div class="xr-var-name">
<span>σ_a</span>
</div>
<div class="xr-var-dims">
()
</div>
<div class="xr-var-dtype">
float64
</div>
<div class="xr-var-preview xr-preview">
1.002
</div>
<input id='attrs-dc339d99-92e8-4ab0-8410-8d5bd3527f32' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-dc339d99-92e8-4ab0-8410-8d5bd3527f32' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-f52122f2-9c8c-4c11-84b7-3c237ec81fd1' class='xr-var-data-in' type='checkbox'><label for='data-f52122f2-9c8c-4c11-84b7-3c237ec81fd1' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label>
<div class="xr-var-attrs">
<dl class="xr-attrs">
</dl>
</div>
<div class="xr-var-data">
<pre>array(1.00158498)</pre>
</div>
</li>
<li class="xr-var-item">
<div class="xr-var-name">
<span>a</span>
</div>
<div class="xr-var-dims">
()
</div>
<div class="xr-var-dtype">
float64
</div>
<div class="xr-var-preview xr-preview">
1.002
</div>
<input id='attrs-50777a4c-8978-4b46-b9a0-4f92d1501ba9' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-50777a4c-8978-4b46-b9a0-4f92d1501ba9' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-bd7e1df4-c2d5-44e4-8f27-060756144a85' class='xr-var-data-in' type='checkbox'><label for='data-bd7e1df4-c2d5-44e4-8f27-060756144a85' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label>
<div class="xr-var-attrs">
<dl class="xr-attrs">
</dl>
</div>
<div class="xr-var-data">
<pre>array(1.00175827)</pre>
</div>
</li>
<li class="xr-var-item">
<div class="xr-var-name">
<span>σ_b</span>
</div>
<div class="xr-var-dims">
()
</div>
<div class="xr-var-dtype">
float64
</div>
<div class="xr-var-preview xr-preview">
1.004
</div>
<input id='attrs-d9fb1fd2-cf37-4ec7-9d86-c6f539f6b9f4' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-d9fb1fd2-cf37-4ec7-9d86-c6f539f6b9f4' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-87934b62-deda-4ac4-a3be-a4ea1786548a' class='xr-var-data-in' type='checkbox'><label for='data-87934b62-deda-4ac4-a3be-a4ea1786548a' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label>
<div class="xr-var-attrs">
<dl class="xr-attrs">
</dl>
</div>
<div class="xr-var-data">
<pre>array(1.00390892)</pre>
</div>
</li>
<li class="xr-var-item">
<div class="xr-var-name">
<span>b</span>
</div>
<div class="xr-var-dims">
()
</div>
<div class="xr-var-dtype">
float64
</div>
<div class="xr-var-preview xr-preview">
1.002
</div>
<input id='attrs-d0d5f26f-aa11-4d68-95dd-7238ac72eeef' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-d0d5f26f-aa11-4d68-95dd-7238ac72eeef' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-183e7681-71b9-45fc-9ac4-3912a45cbaf8' class='xr-var-data-in' type='checkbox'><label for='data-183e7681-71b9-45fc-9ac4-3912a45cbaf8' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label>
<div class="xr-var-attrs">
<dl class="xr-attrs">
</dl>
</div>
<div class="xr-var-data">
<pre>array(1.00210233)</pre>
</div>
</li>
<li class="xr-var-item">
<div class="xr-var-name">
<span>σ</span>
</div>
<div class="xr-var-dims">
()
</div>
<div class="xr-var-dtype">
float64
</div>
<div class="xr-var-preview xr-preview">
1.006
</div>
<input id='attrs-11b31e7e-8d19-4ff1-8459-a0aa0c70ce9b' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-11b31e7e-8d19-4ff1-8459-a0aa0c70ce9b' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-4b7e5eb5-8ceb-4550-80ac-85208e655e2c' class='xr-var-data-in' type='checkbox'><label for='data-4b7e5eb5-8ceb-4550-80ac-85208e655e2c' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label>
<div class="xr-var-attrs">
<dl class="xr-attrs">
</dl>
</div>
<div class="xr-var-data">
<pre>array(1.00598006)</pre>
</div>
</li>
</ul>
</div>
</li>
<li class="xr-section-item">
<input id='section-4774587e-f5da-493a-9b40-8ae8a707171f' class='xr-section-summary-in' type='checkbox' disabled ><label for='section-4774587e-f5da-493a-9b40-8ae8a707171f' class='xr-section-summary'  title='Expand/collapse section'>Attributes: <span>(0)</span></label>
<div class="xr-section-inline-details">

</div>
<div class="xr-section-details">
<dl class="xr-attrs">
</dl>
</div>
</li>
</ul>
</div>
</div>
<p>Again we sample from the posterior predictive distribution of this model and plot the results.</p>
<div class="sourceCode" id="cb39"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>pp_pooled_loglin_df <span class="op">=</span> get_pp_df(pooled_loglin_model, pooled_loglin_trace)</span></code></pre></div>
<div>
<style>
/* Turns off some styling */
progress {
/* gets rid of default border in Firefox and Opera. */
border: none;
/* Needs to be in here for Safari polyfill so background images work as expected. */
background-size: auto;
}
.progress-bar-interrupted, .progress-bar-interrupted::-webkit-progress-bar {
background: #F44336;
}
</style>
<progress value="6000" class max="6000" style="width:300px; height:20px; vertical-align: middle;">
</progress>
<p>100.00% [6000/6000 00:52&lt;00:00]</p>
</div>
<div class="sourceCode" id="cb40"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>pp_pooled_loglin_df.head()</span></code></pre></div>
<center>
<div>
<style scoped>
.dataframe tbody tr th:only-of-type {
vertical-align: middle;
}

.dataframe tbody tr th {
vertical-align: top;
}

.dataframe thead th {
text-align: right;
}
</style>
<table border="1" class="dataframe">
<thead>
<tr style="text-align: right;">
<th>
</th>
<th>
age
</th>
<th>
taxon_id
</th>
<th>
pp_mean
</th>
<th>
pp_low
</th>
<th>
pp_high
</th>
</tr>
</thead>
<tbody>
<tr>
<th>
0
</th>
<td>
1.000000
</td>
<td>
0
</td>
<td>
17.405405
</td>
<td>
9.378821
</td>
<td>
30.602004
</td>
</tr>
<tr>
<th>
1
</th>
<td>
1.000000
</td>
<td>
1
</td>
<td>
9.940230
</td>
<td>
3.453810
</td>
<td>
27.524651
</td>
</tr>
<tr>
<th>
2
</th>
<td>
1.000000
</td>
<td>
2
</td>
<td>
9.484354
</td>
<td>
4.619197
</td>
<td>
18.747739
</td>
</tr>
<tr>
<th>
3
</th>
<td>
1.000000
</td>
<td>
3
</td>
<td>
8.394668
</td>
<td>
4.823675
</td>
<td>
15.338217
</td>
</tr>
<tr>
<th>
4
</th>
<td>
1.071878
</td>
<td>
0
</td>
<td>
19.095916
</td>
<td>
10.369680
</td>
<td>
33.178229
</td>
</tr>
</tbody>
</table>
</div>
</center>
<p><br></p>
<div class="sourceCode" id="cb41"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>plot_pp_by_taxon(pp_pooled_loglin_df)<span class="op">;</span></span></code></pre></div>
<center>
<img src="/resources/tyrannosaurid/Growth%20Curves%20REPARAM_59_0.png" title="fig:" alt="png" />
</center>
<p>Visually, each of the credible intervals appears smaller than for the unpooled model, espescially for Daspletosaurus. We can overlay the posterior predictive plots for the unpooled and pooled log-linear models to confirm this observation.</p>
<div class="sourceCode" id="cb42"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>fig, axes <span class="op">=</span> plot_pp_by_taxon(pp_loglin_df, plot_data<span class="op">=</span><span class="va">False</span>, name<span class="op">=</span><span class="st">&quot;Unpooled log-linear&quot;</span>)</span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>plot_pp_by_taxon(pp_pooled_loglin_df,</span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a>                 name<span class="op">=</span><span class="st">&quot;Pooled log-linear&quot;</span>,</span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a>                 fig<span class="op">=</span>fig, axes<span class="op">=</span>axes)<span class="op">;</span></span></code></pre></div>
<center>
<img src="/resources/tyrannosaurid/Growth%20Curves%20REPARAM_61_0.png" title="fig:" alt="png" />
</center>
<h3 id="unpooled-logistic-model">Unpooled logistic model</h3>
<p>While the log-linear models are reasonable given our exploratory data analysis above (and produce visually plausible results), they are physically unrealistic. With a log-linear model, as the dinosaur gets older its mass will increase without bound. In reality, living creatures have a maximum lifespan, so the log-linear model may be reasonable for realistic ages. Nevertheless, we can incorporate upper bounds on mass by using a <a href="https://en.wikipedia.org/wiki/Logistic_function">logistic function</a> for <span class="math inline">\(f_j\)</span>,</p>
<p><span class="math display">\[f_j(x) = a_j + \frac{b_j}{1 + \exp\left(-(x - c_j)\ /\ d_j\right)}\]</span></p>
<div class="sourceCode" id="cb43"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> logistic(x, a, b, c, d, tensor<span class="op">=</span><span class="va">False</span>):</span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>    exp <span class="op">=</span> at.exp <span class="cf">if</span> tensor <span class="cf">else</span> np.exp</span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> a <span class="op">+</span> b <span class="op">/</span> (<span class="fl">1.</span> <span class="op">+</span> exp(<span class="op">-</span>(x <span class="op">-</span> c) <span class="op">/</span> d))</span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-6"><a href="#cb43-6" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> inv_logistic(y, a, b, c, d, tensor<span class="op">=</span><span class="va">False</span>):</span>
<span id="cb43-7"><a href="#cb43-7" aria-hidden="true" tabindex="-1"></a>    log <span class="op">=</span> at.log <span class="cf">if</span> tensor <span class="cf">else</span> np.log</span>
<span id="cb43-8"><a href="#cb43-8" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb43-9"><a href="#cb43-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> c <span class="op">-</span> d <span class="op">*</span> log(b <span class="op">/</span> (y <span class="op">-</span> a) <span class="op">-</span> <span class="dv">1</span>)</span></code></pre></div>
<p>Note that <code>logistic</code> and its inverse function, <code>inv_logistic</code>, switch between the <code>aesera</code> and <code>numpy</code> implementations of <code>exp</code> and <code>log</code> depending on the <code>tensor</code> parameter.</p>
<div class="sourceCode" id="cb44"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">8</span>, <span class="dv">6</span>))</span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a>A, B, C, D <span class="op">=</span> <span class="dv">1</span>, <span class="dv">5</span>, <span class="dv">10</span>, <span class="dv">3</span></span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a>f <span class="op">=</span> <span class="kw">lambda</span> x: logistic(x, A, B, C, D)</span>
<span id="cb44-6"><a href="#cb44-6" aria-hidden="true" tabindex="-1"></a>f_inv <span class="op">=</span> <span class="kw">lambda</span> y: inv_logistic(y, A, B, C, D)</span>
<span id="cb44-7"><a href="#cb44-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-8"><a href="#cb44-8" aria-hidden="true" tabindex="-1"></a>X_MAX <span class="op">=</span> f_inv(A <span class="op">+</span> B <span class="op">-</span> <span class="fl">0.01</span>)</span>
<span id="cb44-9"><a href="#cb44-9" aria-hidden="true" tabindex="-1"></a>logistic_x <span class="op">=</span> np.linspace(<span class="dv">0</span>, X_MAX)</span>
<span id="cb44-10"><a href="#cb44-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-11"><a href="#cb44-11" aria-hidden="true" tabindex="-1"></a>ax.plot(logistic_x, f(logistic_x))<span class="op">;</span></span>
<span id="cb44-12"><a href="#cb44-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-13"><a href="#cb44-13" aria-hidden="true" tabindex="-1"></a>ax.set_xlim(<span class="dv">0</span>, X_MAX)<span class="op">;</span></span>
<span id="cb44-14"><a href="#cb44-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-15"><a href="#cb44-15" aria-hidden="true" tabindex="-1"></a>ax.set_yticks([<span class="dv">0</span>, f(<span class="dv">0</span>), f(<span class="dv">2</span> <span class="op">*</span> X_MAX)])<span class="op">;</span></span>
<span id="cb44-16"><a href="#cb44-16" aria-hidden="true" tabindex="-1"></a>ax.set_yticklabels([<span class="st">&quot;0&quot;</span>, <span class="vs">r&quot;$f(0)$&quot;</span>,</span>
<span id="cb44-17"><a href="#cb44-17" aria-hidden="true" tabindex="-1"></a>                    <span class="vs">r&quot;$\lim_{x \to \infty}\ f(x)$&quot;</span>])<span class="op">;</span></span>
<span id="cb44-18"><a href="#cb44-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-19"><a href="#cb44-19" aria-hidden="true" tabindex="-1"></a>ax.set_title(<span class="ss">f&quot;Logistic function $f$ with</span><span class="ch">\n</span><span class="ss">$a =$</span><span class="sc">{</span>A<span class="sc">}</span><span class="ss">, $b =$</span><span class="sc">{</span>B<span class="sc">}</span><span class="ss">, $c =$</span><span class="sc">{</span>C<span class="sc">}</span><span class="ss">, $d =$</span><span class="sc">{</span>D<span class="sc">}</span><span class="ss">&quot;</span>)<span class="op">;</span></span></code></pre></div>
<center>
<img src="/resources/tyrannosaurid/Growth%20Curves%20REPARAM_66_0.png" title="fig:" alt="png" />
</center>
<p>We require <span class="math inline">\(a, b, d &gt; 0\)</span>, so we set</p>
<p><span class="math display">\[
\begin{align*}
    a_j
        &amp; = \exp \alpha_j \\
    b_j
        &amp; = \exp \beta_j \\
    d_j
        &amp; = \exp \delta_j.
\end{align*}
\]</span></p>
<p>For the unpooled logistic model we use <span class="math inline">\(\alpha_j \sim N(0, 2.5^2)\)</span> and similarly for <span class="math inline">\(\beta_j\)</span> and <span class="math inline">\(\delta_j\)</span>. We use the same prior for <span class="math inline">\(c_j\)</span> as in the unpooled log-linear model.</p>
<div class="sourceCode" id="cb45"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> pm.Model() <span class="im">as</span> logistic_model:</span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>    α <span class="op">=</span> pm.Normal(<span class="st">&quot;α&quot;</span>, <span class="fl">0.</span>, <span class="fl">2.5</span>, shape<span class="op">=</span>n_taxon)</span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a>    a <span class="op">=</span> pm.Deterministic(<span class="st">&quot;a&quot;</span>, at.exp(α))</span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb45-5"><a href="#cb45-5" aria-hidden="true" tabindex="-1"></a>    β <span class="op">=</span> pm.Normal(<span class="st">&quot;β&quot;</span>, <span class="fl">0.</span>, <span class="fl">2.5</span>, shape<span class="op">=</span>n_taxon)</span>
<span id="cb45-6"><a href="#cb45-6" aria-hidden="true" tabindex="-1"></a>    b <span class="op">=</span> pm.Deterministic(<span class="st">&quot;b&quot;</span>, at.exp(β))</span>
<span id="cb45-7"><a href="#cb45-7" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb45-8"><a href="#cb45-8" aria-hidden="true" tabindex="-1"></a>    c <span class="op">=</span> pm.Normal(<span class="st">&quot;c&quot;</span>, <span class="fl">0.</span>, <span class="fl">2.5</span>, shape<span class="op">=</span>n_taxon)</span>
<span id="cb45-9"><a href="#cb45-9" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb45-10"><a href="#cb45-10" aria-hidden="true" tabindex="-1"></a>    δ <span class="op">=</span> pm.Normal(<span class="st">&quot;δ&quot;</span>, <span class="fl">0.</span>, <span class="fl">2.5</span>, shape<span class="op">=</span>n_taxon)</span>
<span id="cb45-11"><a href="#cb45-11" aria-hidden="true" tabindex="-1"></a>    d <span class="op">=</span> pm.Deterministic(<span class="st">&quot;d&quot;</span>, at.exp(δ))</span></code></pre></div>
<p>The noise variance is also the same as in the unpooled log-linear model. The likelihood is quite similar as well.</p>
<div class="sourceCode" id="cb46"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> logistic_model:</span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>    σ <span class="op">=</span> pm.HalfNormal(<span class="st">&quot;σ&quot;</span>, <span class="fl">2.5</span>, shape<span class="op">=</span>n_taxon)</span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a>    μ <span class="op">=</span> at.log(</span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a>            logistic(log_age_,</span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a>                     a[taxon_id_], b[taxon_id_], c[taxon_id_], d[taxon_id_],</span>
<span id="cb46-6"><a href="#cb46-6" aria-hidden="true" tabindex="-1"></a>                     tensor<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb46-7"><a href="#cb46-7" aria-hidden="true" tabindex="-1"></a>        ) <span class="op">-</span> <span class="fl">0.5</span> <span class="op">*</span> σ[taxon_id_]<span class="op">**</span><span class="dv">2</span></span>
<span id="cb46-8"><a href="#cb46-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-9"><a href="#cb46-9" aria-hidden="true" tabindex="-1"></a>    obs <span class="op">=</span> pm.Normal(<span class="st">&quot;obs&quot;</span>, μ, σ[taxon_id_], observed<span class="op">=</span>log_mass)</span></code></pre></div>
<p>We now sample from the unpooled logistic model.</p>
<div class="sourceCode" id="cb47"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> logistic_model:</span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>    logistic_trace <span class="op">=</span> pm.sample(<span class="op">**</span>SAMPLE_KWARGS)</span></code></pre></div>
<pre><code>Auto-assigning NUTS sampler...
Initializing NUTS using jitter+adapt_diag...
Multiprocess sampling (3 chains in 3 jobs)
NUTS: [σ, δ, c, β, α]</code></pre>
<div>
<style>
/* Turns off some styling */
progress {
/* gets rid of default border in Firefox and Opera. */
border: none;
/* Needs to be in here for Safari polyfill so background images work as expected. */
background-size: auto;
}
.progress-bar-interrupted, .progress-bar-interrupted::-webkit-progress-bar {
background: #F44336;
}
</style>
<progress value="9000" class max="9000" style="width:300px; height:20px; vertical-align: middle;">
</progress>
<p>100.00% [9000/9000 09:42&lt;00:00 Sampling 3 chains, 13 divergences]</p>
</div>
<pre><code>Sampling 3 chains for 1_000 tune and 2_000 draw iterations (3_000 + 6_000 draws total) took 583 seconds.
There were 2 divergences after tuning. Increase `target_accept` or reparameterize.
The chain reached the maximum tree depth. Increase max_treedepth, increase target_accept or reparameterize.
There were 6 divergences after tuning. Increase `target_accept` or reparameterize.
There were 5 divergences after tuning. Increase `target_accept` or reparameterize.
The estimated number of effective samples is smaller than 200 for some parameters.</code></pre>
<p>Again our diagnostics show no obvious cause for concern.</p>
<div class="sourceCode" id="cb50"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a>az.plot_energy(logistic_trace)<span class="op">;</span></span></code></pre></div>
<center>
<img src="/resources/tyrannosaurid/Growth%20Curves%20REPARAM_74_0.png" title="fig:" alt="png" />
</center>
<div class="sourceCode" id="cb51"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a>az.rhat(logistic_trace).<span class="bu">max</span>()</span></code></pre></div>
<div>
<svg style="position: absolute; width: 0; height: 0; overflow: hidden">
<defs> <symbol id="icon-database" viewBox="0 0 32 32"> <path d="M16 0c-8.837 0-16 2.239-16 5v4c0 2.761 7.163 5 16 5s16-2.239 16-5v-4c0-2.761-7.163-5-16-5z"></path> <path d="M16 17c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z"></path> <path d="M16 26c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z"></path> </symbol> <symbol id="icon-file-text2" viewBox="0 0 32 32"> <path d="M28.681 7.159c-0.694-0.947-1.662-2.053-2.724-3.116s-2.169-2.030-3.116-2.724c-1.612-1.182-2.393-1.319-2.841-1.319h-15.5c-1.378 0-2.5 1.121-2.5 2.5v27c0 1.378 1.122 2.5 2.5 2.5h23c1.378 0 2.5-1.122 2.5-2.5v-19.5c0-0.448-0.137-1.23-1.319-2.841zM24.543 5.457c0.959 0.959 1.712 1.825 2.268 2.543h-4.811v-4.811c0.718 0.556 1.584 1.309 2.543 2.268zM28 29.5c0 0.271-0.229 0.5-0.5 0.5h-23c-0.271 0-0.5-0.229-0.5-0.5v-27c0-0.271 0.229-0.5 0.5-0.5 0 0 15.499-0 15.5 0v7c0 0.552 0.448 1 1 1h7v19.5z"></path> <path d="M23 26h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path> <path d="M23 22h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path> <path d="M23 18h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path> </symbol> </defs>
</svg>
<style>/* CSS stylesheet for displaying xarray objects in jupyterlab.
 *
 */

:root {
  --xr-font-color0: var(--jp-content-font-color0, rgba(0, 0, 0, 1));
  --xr-font-color2: var(--jp-content-font-color2, rgba(0, 0, 0, 0.54));
  --xr-font-color3: var(--jp-content-font-color3, rgba(0, 0, 0, 0.38));
  --xr-border-color: var(--jp-border-color2, #e0e0e0);
  --xr-disabled-color: var(--jp-layout-color3, #bdbdbd);
  --xr-background-color: var(--jp-layout-color0, white);
  --xr-background-color-row-even: var(--jp-layout-color1, white);
  --xr-background-color-row-odd: var(--jp-layout-color2, #eeeeee);
}

html[theme=dark],
body.vscode-dark {
  --xr-font-color0: rgba(255, 255, 255, 1);
  --xr-font-color2: rgba(255, 255, 255, 0.54);
  --xr-font-color3: rgba(255, 255, 255, 0.38);
  --xr-border-color: #1F1F1F;
  --xr-disabled-color: #515151;
  --xr-background-color: #111111;
  --xr-background-color-row-even: #111111;
  --xr-background-color-row-odd: #313131;
}

.xr-wrap {
  display: block;
  min-width: 300px;
  max-width: 700px;
}

.xr-text-repr-fallback {
  /* fallback to plain text repr when CSS is not injected (untrusted notebook) */
  display: none;
}

.xr-header {
  padding-top: 6px;
  padding-bottom: 6px;
  margin-bottom: 4px;
  border-bottom: solid 1px var(--xr-border-color);
}

.xr-header > div,
.xr-header > ul {
  display: inline;
  margin-top: 0;
  margin-bottom: 0;
}

.xr-obj-type,
.xr-array-name {
  margin-left: 2px;
  margin-right: 10px;
}

.xr-obj-type {
  color: var(--xr-font-color2);
}

.xr-sections {
  padding-left: 0 !important;
  display: grid;
  grid-template-columns: 150px auto auto 1fr 20px 20px;
}

.xr-section-item {
  display: contents;
}

.xr-section-item input {
  display: none;
}

.xr-section-item input + label {
  color: var(--xr-disabled-color);
}

.xr-section-item input:enabled + label {
  cursor: pointer;
  color: var(--xr-font-color2);
}

.xr-section-item input:enabled + label:hover {
  color: var(--xr-font-color0);
}

.xr-section-summary {
  grid-column: 1;
  color: var(--xr-font-color2);
  font-weight: 500;
}

.xr-section-summary > span {
  display: inline-block;
  padding-left: 0.5em;
}

.xr-section-summary-in:disabled + label {
  color: var(--xr-font-color2);
}

.xr-section-summary-in + label:before {
  display: inline-block;
  content: '►';
  font-size: 11px;
  width: 15px;
  text-align: center;
}

.xr-section-summary-in:disabled + label:before {
  color: var(--xr-disabled-color);
}

.xr-section-summary-in:checked + label:before {
  content: '▼';
}

.xr-section-summary-in:checked + label > span {
  display: none;
}

.xr-section-summary,
.xr-section-inline-details {
  padding-top: 4px;
  padding-bottom: 4px;
}

.xr-section-inline-details {
  grid-column: 2 / -1;
}

.xr-section-details {
  display: none;
  grid-column: 1 / -1;
  margin-bottom: 5px;
}

.xr-section-summary-in:checked ~ .xr-section-details {
  display: contents;
}

.xr-array-wrap {
  grid-column: 1 / -1;
  display: grid;
  grid-template-columns: 20px auto;
}

.xr-array-wrap > label {
  grid-column: 1;
  vertical-align: top;
}

.xr-preview {
  color: var(--xr-font-color3);
}

.xr-array-preview,
.xr-array-data {
  padding: 0 5px !important;
  grid-column: 2;
}

.xr-array-data,
.xr-array-in:checked ~ .xr-array-preview {
  display: none;
}

.xr-array-in:checked ~ .xr-array-data,
.xr-array-preview {
  display: inline-block;
}

.xr-dim-list {
  display: inline-block !important;
  list-style: none;
  padding: 0 !important;
  margin: 0;
}

.xr-dim-list li {
  display: inline-block;
  padding: 0;
  margin: 0;
}

.xr-dim-list:before {
  content: '(';
}

.xr-dim-list:after {
  content: ')';
}

.xr-dim-list li:not(:last-child):after {
  content: ',';
  padding-right: 5px;
}

.xr-has-index {
  font-weight: bold;
}

.xr-var-list,
.xr-var-item {
  display: contents;
}

.xr-var-item > div,
.xr-var-item label,
.xr-var-item > .xr-var-name span {
  background-color: var(--xr-background-color-row-even);
  margin-bottom: 0;
}

.xr-var-item > .xr-var-name:hover span {
  padding-right: 5px;
}

.xr-var-list > li:nth-child(odd) > div,
.xr-var-list > li:nth-child(odd) > label,
.xr-var-list > li:nth-child(odd) > .xr-var-name span {
  background-color: var(--xr-background-color-row-odd);
}

.xr-var-name {
  grid-column: 1;
}

.xr-var-dims {
  grid-column: 2;
}

.xr-var-dtype {
  grid-column: 3;
  text-align: right;
  color: var(--xr-font-color2);
}

.xr-var-preview {
  grid-column: 4;
}

.xr-var-name,
.xr-var-dims,
.xr-var-dtype,
.xr-preview,
.xr-attrs dt {
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  padding-right: 10px;
}

.xr-var-name:hover,
.xr-var-dims:hover,
.xr-var-dtype:hover,
.xr-attrs dt:hover {
  overflow: visible;
  width: auto;
  z-index: 1;
}

.xr-var-attrs,
.xr-var-data {
  display: none;
  background-color: var(--xr-background-color) !important;
  padding-bottom: 5px !important;
}

.xr-var-attrs-in:checked ~ .xr-var-attrs,
.xr-var-data-in:checked ~ .xr-var-data {
  display: block;
}

.xr-var-data > table {
  float: right;
}

.xr-var-name span,
.xr-var-data,
.xr-attrs {
  padding-left: 25px !important;
}

.xr-attrs,
.xr-var-attrs,
.xr-var-data {
  grid-column: 1 / -1;
}

dl.xr-attrs {
  padding: 0;
  margin: 0;
  display: grid;
  grid-template-columns: 125px auto;
}

.xr-attrs dt,
.xr-attrs dd {
  padding: 0;
  margin: 0;
  float: left;
  padding-right: 10px;
  width: auto;
}

.xr-attrs dt {
  font-weight: normal;
  grid-column: 1;
}

.xr-attrs dt:hover span {
  display: inline-block;
  background: var(--xr-background-color);
  padding-right: 10px;
}

.xr-attrs dd {
  grid-column: 2;
  white-space: pre-wrap;
  word-break: break-all;
}

.xr-icon-database,
.xr-icon-file-text2 {
  display: inline-block;
  vertical-align: middle;
  width: 1em;
  height: 1.5em !important;
  stroke-width: 0;
  stroke: currentColor;
  fill: currentColor;
}
</style>
<pre class='xr-text-repr-fallback'>&lt;xarray.Dataset&gt;
Dimensions:  ()
Data variables:
    α        float64 1.017
    β        float64 1.02
    c        float64 1.008
    δ        float64 1.008
    a        float64 1.017
    b        float64 1.02
    d        float64 1.014
    σ        float64 1.024</pre>
<div class="xr-wrap" hidden="">
<div class="xr-header">
<div class="xr-obj-type">
xarray.Dataset
</div>
</div>
<ul class="xr-sections">
<li class="xr-section-item">
<input id='section-92c50d4a-3728-4dee-b86d-921f41e51842' class='xr-section-summary-in' type='checkbox' disabled ><label for='section-92c50d4a-3728-4dee-b86d-921f41e51842' class='xr-section-summary'  title='Expand/collapse section'>Dimensions:</label>
<div class="xr-section-inline-details">

</div>
<div class="xr-section-details">

</div>
</li>
<li class="xr-section-item">
<input id='section-ee762fa9-244c-4fa3-bf51-f9dff5859490' class='xr-section-summary-in' type='checkbox' disabled ><label for='section-ee762fa9-244c-4fa3-bf51-f9dff5859490' class='xr-section-summary'  title='Expand/collapse section'>Coordinates: <span>(0)</span></label>
<div class="xr-section-inline-details">

</div>
<div class="xr-section-details">
<ul class="xr-var-list">
</ul>
</div>
</li>
<li class="xr-section-item">
<input id='section-0d5788e1-87ff-4357-91b2-461f8875535f' class='xr-section-summary-in' type='checkbox'  checked><label for='section-0d5788e1-87ff-4357-91b2-461f8875535f' class='xr-section-summary' >Data variables: <span>(8)</span></label>
<div class="xr-section-inline-details">

</div>
<div class="xr-section-details">
<ul class="xr-var-list">
<li class="xr-var-item">
<div class="xr-var-name">
<span>α</span>
</div>
<div class="xr-var-dims">
()
</div>
<div class="xr-var-dtype">
float64
</div>
<div class="xr-var-preview xr-preview">
1.017
</div>
<input id='attrs-11f895d9-4163-4cb1-91fe-987574607f7d' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-11f895d9-4163-4cb1-91fe-987574607f7d' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-9dcf24f0-8bca-423b-9892-e5eef76284d6' class='xr-var-data-in' type='checkbox'><label for='data-9dcf24f0-8bca-423b-9892-e5eef76284d6' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label>
<div class="xr-var-attrs">
<dl class="xr-attrs">
</dl>
</div>
<div class="xr-var-data">
<pre>array(1.01676666)</pre>
</div>
</li>
<li class="xr-var-item">
<div class="xr-var-name">
<span>β</span>
</div>
<div class="xr-var-dims">
()
</div>
<div class="xr-var-dtype">
float64
</div>
<div class="xr-var-preview xr-preview">
1.02
</div>
<input id='attrs-81740fa3-db8e-43bc-a4df-8492a06cc820' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-81740fa3-db8e-43bc-a4df-8492a06cc820' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-a6cceae8-c040-4867-a643-1f1f71d8c1f2' class='xr-var-data-in' type='checkbox'><label for='data-a6cceae8-c040-4867-a643-1f1f71d8c1f2' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label>
<div class="xr-var-attrs">
<dl class="xr-attrs">
</dl>
</div>
<div class="xr-var-data">
<pre>array(1.02040336)</pre>
</div>
</li>
<li class="xr-var-item">
<div class="xr-var-name">
<span>c</span>
</div>
<div class="xr-var-dims">
()
</div>
<div class="xr-var-dtype">
float64
</div>
<div class="xr-var-preview xr-preview">
1.008
</div>
<input id='attrs-5e574fb1-167c-4e84-8203-2ff3cc638e12' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-5e574fb1-167c-4e84-8203-2ff3cc638e12' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-426c8dce-acc8-4b49-a211-e5a91d86ba47' class='xr-var-data-in' type='checkbox'><label for='data-426c8dce-acc8-4b49-a211-e5a91d86ba47' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label>
<div class="xr-var-attrs">
<dl class="xr-attrs">
</dl>
</div>
<div class="xr-var-data">
<pre>array(1.00824226)</pre>
</div>
</li>
<li class="xr-var-item">
<div class="xr-var-name">
<span>δ</span>
</div>
<div class="xr-var-dims">
()
</div>
<div class="xr-var-dtype">
float64
</div>
<div class="xr-var-preview xr-preview">
1.008
</div>
<input id='attrs-9ba65b39-e61f-4d4b-a8b1-78a641e35086' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-9ba65b39-e61f-4d4b-a8b1-78a641e35086' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-157aad48-b087-4105-911b-516ba3736928' class='xr-var-data-in' type='checkbox'><label for='data-157aad48-b087-4105-911b-516ba3736928' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label>
<div class="xr-var-attrs">
<dl class="xr-attrs">
</dl>
</div>
<div class="xr-var-data">
<pre>array(1.00846537)</pre>
</div>
</li>
<li class="xr-var-item">
<div class="xr-var-name">
<span>a</span>
</div>
<div class="xr-var-dims">
()
</div>
<div class="xr-var-dtype">
float64
</div>
<div class="xr-var-preview xr-preview">
1.017
</div>
<input id='attrs-898ea623-045b-4a7a-8ba2-d0f8b97cf0a3' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-898ea623-045b-4a7a-8ba2-d0f8b97cf0a3' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-7c6aef96-11d7-4700-bba2-56ff5edee482' class='xr-var-data-in' type='checkbox'><label for='data-7c6aef96-11d7-4700-bba2-56ff5edee482' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label>
<div class="xr-var-attrs">
<dl class="xr-attrs">
</dl>
</div>
<div class="xr-var-data">
<pre>array(1.01676666)</pre>
</div>
</li>
<li class="xr-var-item">
<div class="xr-var-name">
<span>b</span>
</div>
<div class="xr-var-dims">
()
</div>
<div class="xr-var-dtype">
float64
</div>
<div class="xr-var-preview xr-preview">
1.02
</div>
<input id='attrs-ddaf7588-9c9d-4a94-9894-35483ed94ff6' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-ddaf7588-9c9d-4a94-9894-35483ed94ff6' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-fdd8c4db-f232-4717-92e1-103fe5ba4671' class='xr-var-data-in' type='checkbox'><label for='data-fdd8c4db-f232-4717-92e1-103fe5ba4671' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label>
<div class="xr-var-attrs">
<dl class="xr-attrs">
</dl>
</div>
<div class="xr-var-data">
<pre>array(1.02040336)</pre>
</div>
</li>
<li class="xr-var-item">
<div class="xr-var-name">
<span>d</span>
</div>
<div class="xr-var-dims">
()
</div>
<div class="xr-var-dtype">
float64
</div>
<div class="xr-var-preview xr-preview">
1.014
</div>
<input id='attrs-7de4b5e7-bddc-4a89-b74a-64c7a7212f7b' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-7de4b5e7-bddc-4a89-b74a-64c7a7212f7b' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-a991c9fa-9195-423f-add5-ae5d7b421e34' class='xr-var-data-in' type='checkbox'><label for='data-a991c9fa-9195-423f-add5-ae5d7b421e34' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label>
<div class="xr-var-attrs">
<dl class="xr-attrs">
</dl>
</div>
<div class="xr-var-data">
<pre>array(1.0135121)</pre>
</div>
</li>
<li class="xr-var-item">
<div class="xr-var-name">
<span>σ</span>
</div>
<div class="xr-var-dims">
()
</div>
<div class="xr-var-dtype">
float64
</div>
<div class="xr-var-preview xr-preview">
1.024
</div>
<input id='attrs-0a712318-2f17-44a5-a643-cb8942b0a1b1' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-0a712318-2f17-44a5-a643-cb8942b0a1b1' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-8f1c2c9e-03d9-408f-8776-8045ec4ba97f' class='xr-var-data-in' type='checkbox'><label for='data-8f1c2c9e-03d9-408f-8776-8045ec4ba97f' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label>
<div class="xr-var-attrs">
<dl class="xr-attrs">
</dl>
</div>
<div class="xr-var-data">
<pre>array(1.02389979)</pre>
</div>
</li>
</ul>
</div>
</li>
<li class="xr-section-item">
<input id='section-ef8739ea-5e98-491a-8e5a-4c949f786e7e' class='xr-section-summary-in' type='checkbox' disabled ><label for='section-ef8739ea-5e98-491a-8e5a-4c949f786e7e' class='xr-section-summary'  title='Expand/collapse section'>Attributes: <span>(0)</span></label>
<div class="xr-section-inline-details">

</div>
<div class="xr-section-details">
<dl class="xr-attrs">
</dl>
</div>
</li>
</ul>
</div>
</div>
<p>Again we sample from the posterior predictive distribution of this model and plot the results.</p>
<div class="sourceCode" id="cb52"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a>pp_logistic_df <span class="op">=</span> get_pp_df(logistic_model, logistic_trace)</span></code></pre></div>
<div>
<style>
/* Turns off some styling */
progress {
/* gets rid of default border in Firefox and Opera. */
border: none;
/* Needs to be in here for Safari polyfill so background images work as expected. */
background-size: auto;
}
.progress-bar-interrupted, .progress-bar-interrupted::-webkit-progress-bar {
background: #F44336;
}
</style>
<progress value="6000" class max="6000" style="width:300px; height:20px; vertical-align: middle;">
</progress>
<p>100.00% [6000/6000 00:35&lt;00:00]</p>
</div>
<div class="sourceCode" id="cb53"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a>pp_logistic_df.head()</span></code></pre></div>
<center>
<div>
<style scoped>
.dataframe tbody tr th:only-of-type {
vertical-align: middle;
}

.dataframe tbody tr th {
vertical-align: top;
}

.dataframe thead th {
text-align: right;
}
</style>
<table border="1" class="dataframe">
<thead>
<tr style="text-align: right;">
<th>
</th>
<th>
age
</th>
<th>
taxon_id
</th>
<th>
pp_mean
</th>
<th>
pp_low
</th>
<th>
pp_high
</th>
</tr>
</thead>
<tbody>
<tr>
<th>
0
</th>
<td>
1.000000
</td>
<td>
0
</td>
<td>
20.229437
</td>
<td>
0.655100
</td>
<td>
809.706349
</td>
</tr>
<tr>
<th>
1
</th>
<td>
1.000000
</td>
<td>
1
</td>
<td>
372.903045
</td>
<td>
0.370631
</td>
<td>
5551.674728
</td>
</tr>
<tr>
<th>
2
</th>
<td>
1.000000
</td>
<td>
2
</td>
<td>
60.408886
</td>
<td>
0.477719
</td>
<td>
1983.882017
</td>
</tr>
<tr>
<th>
3
</th>
<td>
1.000000
</td>
<td>
3
</td>
<td>
11.421099
</td>
<td>
1.119319
</td>
<td>
53.975799
</td>
</tr>
<tr>
<th>
4
</th>
<td>
1.071878
</td>
<td>
0
</td>
<td>
21.909702
</td>
<td>
0.812396
</td>
<td>
642.989663
</td>
</tr>
</tbody>
</table>
</div>
</center>
<p><br></p>
<div class="sourceCode" id="cb54"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a>fig, axes <span class="op">=</span> plot_pp_by_taxon(pp_loglin_df, name<span class="op">=</span><span class="st">&quot;Unpooled log-linear&quot;</span>)</span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a>plot_pp_by_taxon(pp_logistic_df,</span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a>                 name<span class="op">=</span><span class="st">&quot;Unpooled logistic&quot;</span>,</span>
<span id="cb54-4"><a href="#cb54-4" aria-hidden="true" tabindex="-1"></a>                 fig<span class="op">=</span>fig, axes<span class="op">=</span>axes)<span class="op">;</span></span></code></pre></div>
<center>
<img src="/resources/tyrannosaurid/Growth%20Curves%20REPARAM_79_0.png" title="fig:" alt="png" />
</center>
<p>Interestingly, the posterior predictive mean for Daspletosaurus doesn’t seem to fit the observed data as well as the log-linear model, and the credible intervals are quite wide. This observation makes sense given that the logistic model has twice as many parameters, but the number of observations has remained the same.</p>
<h3 id="pooled-logistic">Pooled logistic</h3>
<p>We can once again share information across taxa by specifying a pooled logistic model. This model places hierarchical normal priors on <span class="math inline">\(\alpha\)</span>, <span class="math inline">\(\beta\)</span>, <span class="math inline">\(c\)</span>, and <span class="math inline">\(\delta\)</span>.</p>
<div class="sourceCode" id="cb55"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> pm.Model() <span class="im">as</span> pooled_logistic_model:</span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a>    α <span class="op">=</span> hierarchical_normal(<span class="st">&quot;α&quot;</span>, n_taxon)</span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a>    a <span class="op">=</span> pm.Deterministic(<span class="st">&quot;a&quot;</span>, at.exp(α))</span>
<span id="cb55-4"><a href="#cb55-4" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb55-5"><a href="#cb55-5" aria-hidden="true" tabindex="-1"></a>    β <span class="op">=</span> hierarchical_normal(<span class="st">&quot;β&quot;</span>, n_taxon)</span>
<span id="cb55-6"><a href="#cb55-6" aria-hidden="true" tabindex="-1"></a>    b <span class="op">=</span> pm.Deterministic(<span class="st">&quot;b&quot;</span>, at.exp(β))</span>
<span id="cb55-7"><a href="#cb55-7" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb55-8"><a href="#cb55-8" aria-hidden="true" tabindex="-1"></a>    c <span class="op">=</span> hierarchical_normal(<span class="st">&quot;c&quot;</span>, n_taxon)</span>
<span id="cb55-9"><a href="#cb55-9" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb55-10"><a href="#cb55-10" aria-hidden="true" tabindex="-1"></a>    δ <span class="op">=</span> hierarchical_normal(<span class="st">&quot;δ&quot;</span>, n_taxon)</span>
<span id="cb55-11"><a href="#cb55-11" aria-hidden="true" tabindex="-1"></a>    d <span class="op">=</span> pm.Deterministic(<span class="st">&quot;d&quot;</span>, at.exp(δ))</span></code></pre></div>
<p>The noise variance and likelihood are similar to those of the unpooled logistic model, except we constrain all taxa to share the same noise variance, <span class="math inline">\(\sigma\)</span>, as in the pooled log-linear model.</p>
<div class="sourceCode" id="cb56"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> pooled_logistic_model:</span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a>    σ <span class="op">=</span> pm.HalfNormal(<span class="st">&quot;σ&quot;</span>, <span class="fl">2.5</span>)</span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a>    μ <span class="op">=</span> at.log(</span>
<span id="cb56-4"><a href="#cb56-4" aria-hidden="true" tabindex="-1"></a>            logistic(log_age_,</span>
<span id="cb56-5"><a href="#cb56-5" aria-hidden="true" tabindex="-1"></a>                     a[taxon_id_], b[taxon_id_], c[taxon_id_], d[taxon_id_],</span>
<span id="cb56-6"><a href="#cb56-6" aria-hidden="true" tabindex="-1"></a>                     tensor<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb56-7"><a href="#cb56-7" aria-hidden="true" tabindex="-1"></a>        ) <span class="op">-</span> <span class="fl">0.5</span> <span class="op">*</span> σ<span class="op">**</span><span class="dv">2</span></span>
<span id="cb56-8"><a href="#cb56-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-9"><a href="#cb56-9" aria-hidden="true" tabindex="-1"></a>    obs <span class="op">=</span> pm.Normal(<span class="st">&quot;obs&quot;</span>, μ, σ, observed<span class="op">=</span>log_mass)</span></code></pre></div>
<div class="sourceCode" id="cb57"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> pooled_logistic_model:</span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a>    pooled_logistic_trace <span class="op">=</span> pm.sample(<span class="op">**</span>SAMPLE_KWARGS)</span></code></pre></div>
<pre><code>Auto-assigning NUTS sampler...
Initializing NUTS using jitter+adapt_diag...
Multiprocess sampling (3 chains in 3 jobs)
NUTS: [σ, σ_δ, Δ_δ, μ_δ, σ_c, Δ_c, μ_c, σ_β, Δ_β, μ_β, σ_α, Δ_α, μ_α]</code></pre>
<div>
<style>
/* Turns off some styling */
progress {
/* gets rid of default border in Firefox and Opera. */
border: none;
/* Needs to be in here for Safari polyfill so background images work as expected. */
background-size: auto;
}
.progress-bar-interrupted, .progress-bar-interrupted::-webkit-progress-bar {
background: #F44336;
}
</style>
<progress value="9000" class max="9000" style="width:300px; height:20px; vertical-align: middle;">
</progress>
<p>100.00% [9000/9000 19:02&lt;00:00 Sampling 3 chains, 3 divergences]</p>
</div>
<pre><code>Sampling 3 chains for 1_000 tune and 2_000 draw iterations (3_000 + 6_000 draws total) took 1143 seconds.
There were 2 divergences after tuning. Increase `target_accept` or reparameterize.
There was 1 divergence after tuning. Increase `target_accept` or reparameterize.</code></pre>
<p>Again our diagnostics show no obvious cause for concern.</p>
<div class="sourceCode" id="cb60"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a>az.plot_energy(pooled_logistic_trace)<span class="op">;</span></span></code></pre></div>
<center>
<img src="/resources/tyrannosaurid/Growth%20Curves%20REPARAM_87_0.png" title="fig:" alt="png" />
</center>
<div class="sourceCode" id="cb61"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a>(az.rhat(pooled_logistic_trace[<span class="st">&#39;posterior&#39;</span>])</span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a>   .<span class="bu">max</span>()</span>
<span id="cb61-3"><a href="#cb61-3" aria-hidden="true" tabindex="-1"></a>   .to_array()</span>
<span id="cb61-4"><a href="#cb61-4" aria-hidden="true" tabindex="-1"></a>   .<span class="bu">max</span>())</span></code></pre></div>
<div>
<svg style="position: absolute; width: 0; height: 0; overflow: hidden">
<defs> <symbol id="icon-database" viewBox="0 0 32 32"> <path d="M16 0c-8.837 0-16 2.239-16 5v4c0 2.761 7.163 5 16 5s16-2.239 16-5v-4c0-2.761-7.163-5-16-5z"></path> <path d="M16 17c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z"></path> <path d="M16 26c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z"></path> </symbol> <symbol id="icon-file-text2" viewBox="0 0 32 32"> <path d="M28.681 7.159c-0.694-0.947-1.662-2.053-2.724-3.116s-2.169-2.030-3.116-2.724c-1.612-1.182-2.393-1.319-2.841-1.319h-15.5c-1.378 0-2.5 1.121-2.5 2.5v27c0 1.378 1.122 2.5 2.5 2.5h23c1.378 0 2.5-1.122 2.5-2.5v-19.5c0-0.448-0.137-1.23-1.319-2.841zM24.543 5.457c0.959 0.959 1.712 1.825 2.268 2.543h-4.811v-4.811c0.718 0.556 1.584 1.309 2.543 2.268zM28 29.5c0 0.271-0.229 0.5-0.5 0.5h-23c-0.271 0-0.5-0.229-0.5-0.5v-27c0-0.271 0.229-0.5 0.5-0.5 0 0 15.499-0 15.5 0v7c0 0.552 0.448 1 1 1h7v19.5z"></path> <path d="M23 26h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path> <path d="M23 22h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path> <path d="M23 18h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path> </symbol> </defs>
</svg>
<style>/* CSS stylesheet for displaying xarray objects in jupyterlab.
 *
 */

:root {
  --xr-font-color0: var(--jp-content-font-color0, rgba(0, 0, 0, 1));
  --xr-font-color2: var(--jp-content-font-color2, rgba(0, 0, 0, 0.54));
  --xr-font-color3: var(--jp-content-font-color3, rgba(0, 0, 0, 0.38));
  --xr-border-color: var(--jp-border-color2, #e0e0e0);
  --xr-disabled-color: var(--jp-layout-color3, #bdbdbd);
  --xr-background-color: var(--jp-layout-color0, white);
  --xr-background-color-row-even: var(--jp-layout-color1, white);
  --xr-background-color-row-odd: var(--jp-layout-color2, #eeeeee);
}

html[theme=dark],
body.vscode-dark {
  --xr-font-color0: rgba(255, 255, 255, 1);
  --xr-font-color2: rgba(255, 255, 255, 0.54);
  --xr-font-color3: rgba(255, 255, 255, 0.38);
  --xr-border-color: #1F1F1F;
  --xr-disabled-color: #515151;
  --xr-background-color: #111111;
  --xr-background-color-row-even: #111111;
  --xr-background-color-row-odd: #313131;
}

.xr-wrap {
  display: block;
  min-width: 300px;
  max-width: 700px;
}

.xr-text-repr-fallback {
  /* fallback to plain text repr when CSS is not injected (untrusted notebook) */
  display: none;
}

.xr-header {
  padding-top: 6px;
  padding-bottom: 6px;
  margin-bottom: 4px;
  border-bottom: solid 1px var(--xr-border-color);
}

.xr-header > div,
.xr-header > ul {
  display: inline;
  margin-top: 0;
  margin-bottom: 0;
}

.xr-obj-type,
.xr-array-name {
  margin-left: 2px;
  margin-right: 10px;
}

.xr-obj-type {
  color: var(--xr-font-color2);
}

.xr-sections {
  padding-left: 0 !important;
  display: grid;
  grid-template-columns: 150px auto auto 1fr 20px 20px;
}

.xr-section-item {
  display: contents;
}

.xr-section-item input {
  display: none;
}

.xr-section-item input + label {
  color: var(--xr-disabled-color);
}

.xr-section-item input:enabled + label {
  cursor: pointer;
  color: var(--xr-font-color2);
}

.xr-section-item input:enabled + label:hover {
  color: var(--xr-font-color0);
}

.xr-section-summary {
  grid-column: 1;
  color: var(--xr-font-color2);
  font-weight: 500;
}

.xr-section-summary > span {
  display: inline-block;
  padding-left: 0.5em;
}

.xr-section-summary-in:disabled + label {
  color: var(--xr-font-color2);
}

.xr-section-summary-in + label:before {
  display: inline-block;
  content: '►';
  font-size: 11px;
  width: 15px;
  text-align: center;
}

.xr-section-summary-in:disabled + label:before {
  color: var(--xr-disabled-color);
}

.xr-section-summary-in:checked + label:before {
  content: '▼';
}

.xr-section-summary-in:checked + label > span {
  display: none;
}

.xr-section-summary,
.xr-section-inline-details {
  padding-top: 4px;
  padding-bottom: 4px;
}

.xr-section-inline-details {
  grid-column: 2 / -1;
}

.xr-section-details {
  display: none;
  grid-column: 1 / -1;
  margin-bottom: 5px;
}

.xr-section-summary-in:checked ~ .xr-section-details {
  display: contents;
}

.xr-array-wrap {
  grid-column: 1 / -1;
  display: grid;
  grid-template-columns: 20px auto;
}

.xr-array-wrap > label {
  grid-column: 1;
  vertical-align: top;
}

.xr-preview {
  color: var(--xr-font-color3);
}

.xr-array-preview,
.xr-array-data {
  padding: 0 5px !important;
  grid-column: 2;
}

.xr-array-data,
.xr-array-in:checked ~ .xr-array-preview {
  display: none;
}

.xr-array-in:checked ~ .xr-array-data,
.xr-array-preview {
  display: inline-block;
}

.xr-dim-list {
  display: inline-block !important;
  list-style: none;
  padding: 0 !important;
  margin: 0;
}

.xr-dim-list li {
  display: inline-block;
  padding: 0;
  margin: 0;
}

.xr-dim-list:before {
  content: '(';
}

.xr-dim-list:after {
  content: ')';
}

.xr-dim-list li:not(:last-child):after {
  content: ',';
  padding-right: 5px;
}

.xr-has-index {
  font-weight: bold;
}

.xr-var-list,
.xr-var-item {
  display: contents;
}

.xr-var-item > div,
.xr-var-item label,
.xr-var-item > .xr-var-name span {
  background-color: var(--xr-background-color-row-even);
  margin-bottom: 0;
}

.xr-var-item > .xr-var-name:hover span {
  padding-right: 5px;
}

.xr-var-list > li:nth-child(odd) > div,
.xr-var-list > li:nth-child(odd) > label,
.xr-var-list > li:nth-child(odd) > .xr-var-name span {
  background-color: var(--xr-background-color-row-odd);
}

.xr-var-name {
  grid-column: 1;
}

.xr-var-dims {
  grid-column: 2;
}

.xr-var-dtype {
  grid-column: 3;
  text-align: right;
  color: var(--xr-font-color2);
}

.xr-var-preview {
  grid-column: 4;
}

.xr-var-name,
.xr-var-dims,
.xr-var-dtype,
.xr-preview,
.xr-attrs dt {
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  padding-right: 10px;
}

.xr-var-name:hover,
.xr-var-dims:hover,
.xr-var-dtype:hover,
.xr-attrs dt:hover {
  overflow: visible;
  width: auto;
  z-index: 1;
}

.xr-var-attrs,
.xr-var-data {
  display: none;
  background-color: var(--xr-background-color) !important;
  padding-bottom: 5px !important;
}

.xr-var-attrs-in:checked ~ .xr-var-attrs,
.xr-var-data-in:checked ~ .xr-var-data {
  display: block;
}

.xr-var-data > table {
  float: right;
}

.xr-var-name span,
.xr-var-data,
.xr-attrs {
  padding-left: 25px !important;
}

.xr-attrs,
.xr-var-attrs,
.xr-var-data {
  grid-column: 1 / -1;
}

dl.xr-attrs {
  padding: 0;
  margin: 0;
  display: grid;
  grid-template-columns: 125px auto;
}

.xr-attrs dt,
.xr-attrs dd {
  padding: 0;
  margin: 0;
  float: left;
  padding-right: 10px;
  width: auto;
}

.xr-attrs dt {
  font-weight: normal;
  grid-column: 1;
}

.xr-attrs dt:hover span {
  display: inline-block;
  background: var(--xr-background-color);
  padding-right: 10px;
}

.xr-attrs dd {
  grid-column: 2;
  white-space: pre-wrap;
  word-break: break-all;
}

.xr-icon-database,
.xr-icon-file-text2 {
  display: inline-block;
  vertical-align: middle;
  width: 1em;
  height: 1.5em !important;
  stroke-width: 0;
  stroke: currentColor;
  fill: currentColor;
}
</style>
<pre class='xr-text-repr-fallback'>&lt;xarray.DataArray ()&gt;
array(1.00208561)</pre>
<div class="xr-wrap" hidden="">
<div class="xr-header">
<div class="xr-obj-type">
xarray.DataArray
</div>
<div class="xr-array-name">

</div>
</div>
<ul class="xr-sections">
<li class="xr-section-item">
<div class="xr-array-wrap">
<input id='section-06ec754e-834b-4f15-bc27-676cd22b9335' class='xr-array-in' type='checkbox' checked><label for='section-06ec754e-834b-4f15-bc27-676cd22b9335' title='Show/hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label>
<div class="xr-array-preview xr-preview">
<span>1.002</span>
</div>
<div class="xr-array-data">
<pre>array(1.00208561)</pre>
</div>
</div>
</li>
<li class="xr-section-item">
<input id='section-1aca641d-a2c0-4778-8cb0-2dbf0567048b' class='xr-section-summary-in' type='checkbox' disabled ><label for='section-1aca641d-a2c0-4778-8cb0-2dbf0567048b' class='xr-section-summary'  title='Expand/collapse section'>Coordinates: <span>(0)</span></label>
<div class="xr-section-inline-details">

</div>
<div class="xr-section-details">
<ul class="xr-var-list">
</ul>
</div>
</li>
<li class="xr-section-item">
<input id='section-d5aedee9-d89e-4f49-9bff-3d8ecceff141' class='xr-section-summary-in' type='checkbox' disabled ><label for='section-d5aedee9-d89e-4f49-9bff-3d8ecceff141' class='xr-section-summary'  title='Expand/collapse section'>Attributes: <span>(0)</span></label>
<div class="xr-section-inline-details">

</div>
<div class="xr-section-details">
<dl class="xr-attrs">
</dl>
</div>
</li>
</ul>
</div>
</div>
<p>Again we sample from the posterior predictive distribution of this model and plot the results.</p>
<div class="sourceCode" id="cb62"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a>pp_pooled_logistic_df <span class="op">=</span> get_pp_df(pooled_logistic_model, pooled_logistic_trace)</span></code></pre></div>
<div>
<style>
/* Turns off some styling */
progress {
/* gets rid of default border in Firefox and Opera. */
border: none;
/* Needs to be in here for Safari polyfill so background images work as expected. */
background-size: auto;
}
.progress-bar-interrupted, .progress-bar-interrupted::-webkit-progress-bar {
background: #F44336;
}
</style>
<progress value="6000" class max="6000" style="width:300px; height:20px; vertical-align: middle;">
</progress>
<p>100.00% [6000/6000 01:08&lt;00:00]</p>
</div>
<div class="sourceCode" id="cb63"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a>pp_pooled_logistic_df.head()</span></code></pre></div>
<center>
<div>
<style scoped>
.dataframe tbody tr th:only-of-type {
vertical-align: middle;
}

.dataframe tbody tr th {
vertical-align: top;
}

.dataframe thead th {
text-align: right;
}
</style>
<table border="1" class="dataframe">
<thead>
<tr style="text-align: right;">
<th>
</th>
<th>
age
</th>
<th>
taxon_id
</th>
<th>
pp_mean
</th>
<th>
pp_low
</th>
<th>
pp_high
</th>
</tr>
</thead>
<tbody>
<tr>
<th>
0
</th>
<td>
1.000000
</td>
<td>
0
</td>
<td>
22.852762
</td>
<td>
10.267422
</td>
<td>
56.497339
</td>
</tr>
<tr>
<th>
1
</th>
<td>
1.000000
</td>
<td>
1
</td>
<td>
9.839328
</td>
<td>
0.906120
</td>
<td>
125.299677
</td>
</tr>
<tr>
<th>
2
</th>
<td>
1.000000
</td>
<td>
2
</td>
<td>
12.589540
</td>
<td>
3.182979
</td>
<td>
91.279583
</td>
</tr>
<tr>
<th>
3
</th>
<td>
1.000000
</td>
<td>
3
</td>
<td>
11.080350
</td>
<td>
4.344195
</td>
<td>
36.627854
</td>
</tr>
<tr>
<th>
4
</th>
<td>
1.071878
</td>
<td>
0
</td>
<td>
24.465512
</td>
<td>
11.729286
</td>
<td>
56.373575
</td>
</tr>
</tbody>
</table>
</div>
</center>
<p><br></p>
<div class="sourceCode" id="cb64"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a>fig, axes <span class="op">=</span> plot_pp_by_taxon(pp_logistic_df, plot_data<span class="op">=</span><span class="va">False</span>, name<span class="op">=</span><span class="st">&quot;Unpooled logistic&quot;</span>)</span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a>plot_pp_by_taxon(pp_pooled_logistic_df,</span>
<span id="cb64-3"><a href="#cb64-3" aria-hidden="true" tabindex="-1"></a>                 name<span class="op">=</span><span class="st">&quot;Pooled logistic&quot;</span>,</span>
<span id="cb64-4"><a href="#cb64-4" aria-hidden="true" tabindex="-1"></a>                 fig<span class="op">=</span>fig, axes<span class="op">=</span>axes)<span class="op">;</span></span></code></pre></div>
<center>
<img src="/resources/tyrannosaurid/Growth%20Curves%20REPARAM_92_0.png" title="fig:" alt="png" />
</center>
<p>We see that the posterior predictive means for the pooled logistic model fit better than those from the unpooled model, and that the credible intervals are again significantly smaller.</p>
<p>We now compare the posterior predictions for the pooled log-linear and logistic models.</p>
<div class="sourceCode" id="cb65"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a>fig, axes <span class="op">=</span> plot_pp_by_taxon(pp_pooled_loglin_df, plot_data<span class="op">=</span><span class="va">False</span>, name<span class="op">=</span><span class="st">&quot;Pooled log-linear&quot;</span>)</span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a>plot_pp_by_taxon(pp_pooled_logistic_df,</span>
<span id="cb65-3"><a href="#cb65-3" aria-hidden="true" tabindex="-1"></a>                 name<span class="op">=</span><span class="st">&quot;Pooled logistic&quot;</span>,</span>
<span id="cb65-4"><a href="#cb65-4" aria-hidden="true" tabindex="-1"></a>                 fig<span class="op">=</span>fig, axes<span class="op">=</span>axes)<span class="op">;</span></span></code></pre></div>
<center>
<img src="/resources/tyrannosaurid/Growth%20Curves%20REPARAM_94_0.png" title="fig:" alt="png" />
</center>
<p>These models agree with each other fairly well, espescially in age ranges where the taxon data is concentrated, with the logistic model making slightly more plausible predictions as age increases.</p>
<h3 id="model-comparison">Model comparison</h3>
<p>We now compare these four models using two of the information criteria available in <code>arviz</code>. While <em>BSM</em> uses the <a href="https://en.wikipedia.org/wiki/Deviance_information_criterion">deviance information criterion</a> (DIC) to compare models, DIC is no longer supported in <code>pymc3</code> or <code>arviz</code>, so we use Pareto-smoothed importance sampling leave-one-out cross validation (PSIS-LOO) and the widely applicable information criterion (WAIC) to compare models. These information criteria are available in <code>arviz</code>. For details on these methods, consult the <a href="https://docs.pymc.io/notebooks/model_comparison.html"><code>pymc3</code> documentation</a>.</p>
<div class="sourceCode" id="cb66"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a>traces <span class="op">=</span> {</span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;Unpooled log-linear&#39;</span>: loglin_trace,</span>
<span id="cb66-3"><a href="#cb66-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;Pooled log-linear&#39;</span>: pooled_loglin_trace,</span>
<span id="cb66-4"><a href="#cb66-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;Unpooled logistic&#39;</span>: logistic_trace,</span>
<span id="cb66-5"><a href="#cb66-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;Pooled logistic&#39;</span>: pooled_logistic_trace</span>
<span id="cb66-6"><a href="#cb66-6" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<div class="sourceCode" id="cb67"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> plot_compare(comp_df, ic, height<span class="op">=</span><span class="dv">6</span>, fig<span class="op">=</span><span class="va">None</span>, axes<span class="op">=</span><span class="va">None</span>):</span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> fig <span class="kw">is</span> <span class="va">None</span> <span class="kw">or</span> axes <span class="kw">is</span> <span class="va">None</span>:</span>
<span id="cb67-3"><a href="#cb67-3" aria-hidden="true" tabindex="-1"></a>        fig, axes <span class="op">=</span> plt.subplots(</span>
<span id="cb67-4"><a href="#cb67-4" aria-hidden="true" tabindex="-1"></a>            ncols<span class="op">=</span><span class="dv">2</span>, figsize<span class="op">=</span>(<span class="dv">16</span> <span class="op">*</span> (height <span class="op">/</span> <span class="dv">6</span>), height)</span>
<span id="cb67-5"><a href="#cb67-5" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb67-6"><a href="#cb67-6" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb67-7"><a href="#cb67-7" aria-hidden="true" tabindex="-1"></a>    score_ax, weight_ax <span class="op">=</span> axes</span>
<span id="cb67-8"><a href="#cb67-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-9"><a href="#cb67-9" aria-hidden="true" tabindex="-1"></a>    az.plot_compare(comp_df, insample_dev<span class="op">=</span><span class="va">False</span>, plot_ic_diff<span class="op">=</span><span class="va">False</span>, ax<span class="op">=</span>score_ax)</span>
<span id="cb67-10"><a href="#cb67-10" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb67-11"><a href="#cb67-11" aria-hidden="true" tabindex="-1"></a>    score_ax.set_xlabel(<span class="st">&quot;Log score&quot;</span>)</span>
<span id="cb67-12"><a href="#cb67-12" aria-hidden="true" tabindex="-1"></a>    score_ax.set_ylabel(<span class="st">&quot;Model&quot;</span>)</span>
<span id="cb67-13"><a href="#cb67-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-14"><a href="#cb67-14" aria-hidden="true" tabindex="-1"></a>    comp_df[<span class="st">&#39;weight&#39;</span>].plot.barh(ax<span class="op">=</span>weight_ax)</span>
<span id="cb67-15"><a href="#cb67-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-16"><a href="#cb67-16" aria-hidden="true" tabindex="-1"></a>    weight_ax.set_xscale(<span class="st">&#39;log&#39;</span>)</span>
<span id="cb67-17"><a href="#cb67-17" aria-hidden="true" tabindex="-1"></a>    weight_ax.set_xlim(right<span class="op">=</span><span class="dv">2</span>)</span>
<span id="cb67-18"><a href="#cb67-18" aria-hidden="true" tabindex="-1"></a>    weight_ax.set_xlabel(<span class="st">&quot;Stacking weight&quot;</span>)</span>
<span id="cb67-19"><a href="#cb67-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-20"><a href="#cb67-20" aria-hidden="true" tabindex="-1"></a>    weight_ax.set_yticklabels([])</span>
<span id="cb67-21"><a href="#cb67-21" aria-hidden="true" tabindex="-1"></a>    weight_ax.invert_yaxis()</span>
<span id="cb67-22"><a href="#cb67-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-23"><a href="#cb67-23" aria-hidden="true" tabindex="-1"></a>    fig.suptitle(<span class="ss">f&quot;</span><span class="sc">{</span>ic<span class="sc">}</span><span class="ss"> comparison&quot;</span>)</span>
<span id="cb67-24"><a href="#cb67-24" aria-hidden="true" tabindex="-1"></a>    fig.tight_layout()</span>
<span id="cb67-25"><a href="#cb67-25" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb67-26"><a href="#cb67-26" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> fig, axes</span></code></pre></div>
<p>The following plots show the PSIS-LOO comparison for these models.</p>
<div class="sourceCode" id="cb68"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a>loo_df <span class="op">=</span> az.compare(traces, ic<span class="op">=</span><span class="st">&#39;loo&#39;</span>, seed<span class="op">=</span>SEED)</span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a>plot_compare(loo_df, <span class="st">&quot;LOO&quot;</span>)<span class="op">;</span></span></code></pre></div>
<center>
<img src="/resources/tyrannosaurid/Growth%20Curves%20REPARAM_100_0.png" title="fig:" alt="png" />
</center>
<p>Note that larger scores are better, so PSIS-LOO favors the pooled models over the unpooled models and favors the pooled logistic model most highly of all.</p>
<div class="sourceCode" id="cb69"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a>waic_df <span class="op">=</span> az.compare(traces, ic<span class="op">=</span><span class="st">&#39;waic&#39;</span>, seed<span class="op">=</span>SEED)</span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a>plot_compare(waic_df, <span class="st">&quot;WAIC&quot;</span>)<span class="op">;</span></span></code></pre></div>
<center>
<img src="/resources/tyrannosaurid/Growth%20Curves%20REPARAM_102_0.png" title="fig:" alt="png" />
</center>
<p>Using WAIC produces quite similar results.</p>
<p>Interestingly, the results in <em>BSM</em> using DIC favor the logistic model slightly.</p>
<p>Many thanks to Reich and Ghosh for their excellent textbook which brought this fun dataset to my attention and to <a href="https://kirilzvezdarov.com/about.html">Kiril Zvezdarov</a> for his comments on early drafts.</p>
<p>The notebook this post was generated from is available <a href="https://nbviewer.jupyter.org/gist/AustinRochford/0baa4147c879556ee7cf3d9b0a663fb8">here</a>.</p>
<div class="sourceCode" id="cb70"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a><span class="op">%</span>load_ext watermark</span>
<span id="cb70-2"><a href="#cb70-2" aria-hidden="true" tabindex="-1"></a><span class="op">%</span>watermark <span class="op">-</span>n <span class="op">-</span>u <span class="op">-</span>v <span class="op">-</span>iv</span></code></pre></div>
<pre><code>Last updated: Sun May 16 2021

Python implementation: CPython
Python version       : 3.8.8
IPython version      : 7.22.0

pymc3     : 3.11.1
seaborn   : 0.11.1
pandas    : 1.2.3
arviz     : 0.11.2
matplotlib: 3.4.1
numpy     : 1.20.2
aesara    : 2.0.6</code></pre>
